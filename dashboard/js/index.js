var customObj,userDetails,companyId,viewedItems,trial,tempCode,smartDriver,openStatus,deliveryLat,deliveryLng,currentShopId="",currentShopName="",totalCost=0,totalWeight=0,totalBuying=0,clientToken="",itemListArray=[],processing=!1,loggedIn=!1,phoneNo=window.localStorage.getItem("phoneNo"),shopLogged=window.localStorage.getItem("shop-id"),shopLoggedName=window.localStorage.getItem("shop-name"),todateSales=0,todateProfit=0,userLogged="",shopDescription="",positionLogged=window.localStorage.getItem("positionLogged"),loggedUserId=window.localStorage.getItem("loggedUserId"),currencyCode=window.localStorage.getItem("currencyCode"),currentTill="",itemsOnCart=[],remotePurchase="false",accountBal=0,accountActive=!0,filter=/^[0-9-+]+$/,serverUrl="https://www.smartstore.techapis.xyz/",loggedInUser=window.localStorage.getItem("loggedInUser"),password=window.localStorage.getItem("password"),currentLatitude=null,currentLongitude=null,radius=window.localStorage.getItem("radius"),serviceFee=0,extraCharges=0,paymentGatewayObj=[],paypalObj=[],distanceFromStore=0,deliveryFee=0,userIsDriver=window.localStorage.getItem("userIsDriver"),myCurrencyCode=window.localStorage.getItem("currency_code"),packageSubscribed="TRIAL",shopLatitude=0,shopLongitude=0;radius=null==radius?30:parseFloat(radius);var myApp=new Framework7({modalTitle:"",material:!0,pushState:!0}),$$=Dom7,mainView=myApp.addView(".view-main",{dynamicNavbar:!0,domCache:!0});myApp.onPageInit("welcome-page",function(e){setTimeout(function(){null!=shopLogged?(mainView.router.load({pageName:"shop-main-page"}),userLogged="shop",currentShopId=shopLogged):userLogged="customer",getActivationDate(),$$(".shop-account-ul-btn").hide()},1e3)});var initialUrl=window.location;function deviceReady(){var e=io("https://www.smartstore.techapis.xyz");if(deviceReady.returnSocket=function(){return e},null!=shopLogged)$$(".shopNameShow").text(shopLoggedName.toUpperCase()),userLogged="shop",currentShopId=shopLogged,"WAITER/WAITRESS/DELIVERER"==positionLogged?(mainView.router.load({pageName:"deliverer-main-page"}),getOrdersToDeliver()):(mainView.router.load({pageName:"shop-main-page"}),$$(".store-link-after").text("https://smartstoreweb.net/dashboard/#!/#"+currentShopId),getOrders("getOrdersShop"),getReportsFn(),updateLocation(1e3));else{var t=initialUrl.toString().split("#!/#")[1];null==t?(mainView.router.load({pageName:"welcome-page"}),getLocalStores()):"S"==t[0]&&"I"==t[1]||"1111"==t?selfLogin(t,"normal"):(mainView.router.load({pageName:"welcome-page"}),getLocalStores()),userLogged="customer"}getActivationDate(),e.on("CashierID-Verify",function(t,i,a,o,s,r,n,c,l,d,p){currentShopId==s&&currentTill==t&&myApp.confirm("Click on Accept if you have the amount mentioned above or else Reject the transaction!","PLEASE GET PAYMENT OF R "+i,function(s){e.emit("cash-payment-accepted",t,i,a,o,currentShopId,r,n,c,l,d,p)})}),e.on("verifyCashPayment",function(t,i,a,o,s,r,n,c,l,d,p,m,u,v,h,g,$){currentShopId==s&&currentTill==t&&myApp.confirm("Click on Accept if you have the amount mentioned above or else Reject the transaction!","PLEASE GET PAYMENT OF "+p+" "+i,function(y){e.emit("cash-payment-accepted",t,i,a,o,s,r,n,c,l,d,p,m,u,v,h,g,$,function(e){stopProcess(),showToast(e?"The transaction was success":"Something went wrong while trying to accept the transaction")}),processStatus(1e4)})}),e.on("cash-payment-accepted",function(e,t,i,a,o,s,r,n,c,l,d,p,m,u,v,h,g){r==loggedInUser&&(stopProcess(),processPayment("",t,"","",m,u,v,h,"CA"),processStatus(1e4))}),e.on("get-payment-history",function(e,t,i,a,o,s){0==$("[orderNumber='"+e+"']").length&&$$(".list-shopid-ul").prepend("<li shopId='"+t+"' orderNumber='"+e+"' itemListString='"+a+"' totalPrice='"+o+"' weight='"+s+"'><div class='item-content item-link'><div class='item-media'><i class='material-icons color-teal'>store</i></div><div class='item-inner'><div class='item-title'>"+i+"</div><div class='item-after'>#"+e+"</div></div></div></li>")}),e.on("get-most-purchased",function(e,t,i,a,o){var s=parseFloat(a)*parseFloat(t),r=(s-parseFloat(o)*parseFloat(t)).toFixed(2);0==$("[most-purchased='"+e+"']").length&&$$(".most-purchased-ul").append("<div class='card most-purchased-li' most-purchased='"+e+"'><div class='card-header item-title'>"+i+"</div><div class='card-content'><div class='card-content-inner'><div class='list-block'><ul><li><div class='item-content'><div class='item-inner'><div class='item-title'>ITEMS SOLD</div><div class='item-after'>"+t+"</div></div></div></li><li><div class='item-content'><div class='item-inner'><div class='item-title'>TODATE SALES</div><div class='item-after'>"+currencyCode+" "+s.toFixed(2)+"</div></div></div></li><li><div class='item-content'><div class='item-inner'><div class='item-title'>TODATE PROFIT</div><div class='item-after'>"+currencyCode+" "+r+"</div></div></div></li></ul></div></div></div></div>"),stopProcess()}),e.on("item-found",function(e,t,i,a,o,s,r,n){stopProcess(),0==$$("[item-found='"+e+"']").length&&$$(".item-search-found").append("<div class='card' item-found='"+e+"' style='border-radius:20px;box-shadow:none;'><div class='card-header color-teal' style='font-weight:bold;'>"+a.toUpperCase()+"</div><div class='card-content-inner list-block'><ul><li><div class='item-content'><div class='item-inner'><div class='item-title'>SHOP NAME</div><div class='item-after'>"+t.toUpperCase()+"</div></div></div></li><li><div class='item-content'><div class='item-inner'><div class='item-title'>COST</div><div class='item-after' style='color:tomato;'>"+parseFloat(o).toFixed(2)+"</div></div></div></li><li><div class='item-content'><div class='item-inner'><div class='item-title'>ITEMS LEFT</div><div class='item-after'>"+s+"</div></div></div></li><li><div class='item-content'><div class='item-inner'><div class='item-title'>ADDRESS</div><div class='item-after'>"+i+"</div></div></div></li></ul></div><div class='card-footer'><a href='#' class='link go-to-shop-panel-btn' shopId='"+e+"'><i class='material-icons color-purple'>shopping_basket</i></a><a href='#' class='link getLocationBtn' latitude='"+r+"' longitude='"+n+"' shopName='"+t+"'><i class='material-icons color-teal'>location_on</i></a></div></div>")}),e.on("no-results-found",function(e){stopProcess(),$$(".item-search-found").html("<center><h3>"+e+"</h3></center>")}),e.on("orderIsReady",function(e){var t=e[0].placedBy;loggedInUser==t&&myApp.alert("ORDER "+e[0].id+" IS READ","ORDER READY")}),e.on("newOrder",function(e,t,i,a,o,s,r,n,c){currentShopId==n&&(getOrders("getOrdersShop"),getReportsFn())}),e.on("driverMarkJobAsDone",function(e,t,i,a){t==phoneNo&&myApp.confirm("Have you received your delivery?","CONFIRM DELIVERY",function(t){confirmDelivery(e,i,a)})}),e.on("buyerConfirmDelivery",function(e,t,i){i==phoneNo&&(stopProcess(),myApp.alert("Order "+e+" has been marked as delivered. Collect "+myCurrencyCode+" "+parseFloat(t).toFixed(2)+" from the buyer","ORDER DELIVERED"))}),e.on("remoteScan",function(e,t,i){t==currentShopId&&("scanToSell"==e?getBarcodeItems(t,"POS","BARCODE",i):"scanToAdd"==e&&scanToAdd(i))})}function geoCodeAddress(e,t){var i="https://maps.googleapis.com/maps/api/geocode/json?address="+(e=encodeURIComponent(e))+"&key=AIzaSyCX4BPLJ1EoHgY9LaDTfciCb3tidpIijPk",a=new FormData;$.ajax({url:i,type:"POST",data:a,processData:!1,contentType:!1,success:function(e){t(e.results[0].geometry.location.lat,e.results[0].geometry.location.lng)}})}function processStatus(e){myApp.showPreloader("Processing, Please wait..."),processing=!0,setTimeout(function(){1==processing&&(myApp.hidePreloader(),myApp.alert("There was an error, Or check your internet connection"),processing=!1)},e)}function stopProcess(){processing=!1,myApp.hidePreloader()}function exp_date_check(e){return 5==e.length&&"/"==e[2]?e:"Please provide a valid exp date like (10/20)"}function showToast(e){myApp.alert(e)}function removeItemObj(e,t){for(var i=0;i<e.length;i++)if(e[i].id==t){e.splice(i,1);break}}function removeItemDay(e,t){for(var i=0;i<e.length;i++)if(e[i].day==t){e.splice(i,1);break}}function getShortTime(){var e=new Date,t=e.getFullYear().toString(),i=e.getMonth()+1,a=e.getDate(),o=e.getHours(),s=e.getMinutes();return s=s<10?"0"+s:s,a=a<10?"0"+a:a,o=o<10?"0"+o:o,i=i<10?"0"+i:i,t.substring(2,4)+i+a+"."+o+s}function getTime(){var e=new Date,t=e.getFullYear(),i=e.getMonth()+1,a=e.getDate(),o=e.getHours(),s=e.getMinutes();1==i?i="Jan":2==i?i="Feb":3==i?i="Mar":4==i?i="Apr":5==i?i="May":6==i?i="Jun":7==i?i="Jul":8==i?i="Aug":9==i?i="Sep":10==i?i="Oct":11==i?i="Nov":12==i&&(i="Dec"),s=s<10?"0"+s:s,a=a<10?"0"+a:a,o=o<10?"0"+o:o;e.getDay();return a+" "+i+" "+t+" "+o+":"+s}function changeNumber(){$$(".customer-phone-input").val(window.localStorage.getItem("phoneNo")),$$(".customer-address-input").val(window.localStorage.getItem("deliveryAddress")),mainView.router.load({pageName:"update-number-page"})}function phoneNoValidation(e){return phoneNumber=e.replace(/ /g,""),phoneNumber.length<12&&phoneNumber.length>7?("0"!=phoneNumber[0]?phoneNumber=phoneNumber:phoneNumber=phoneNumber.slice(1,phoneNumber.length),phoneNumber):"Incorrect phone number"}function getOrdersToDeliver(){var e=deviceReady.returnSocket();$$(".orders-to-deliver-ul").html(""),e.emit("getOrdersToDeliver",currentShopId,function(e){if(e.length>0)for(var t=0;t<e.length;t++){var i=e[t].latitude,a=e[t].longitude,o=e[t].buyerNumber,s=e[t].id;$$(".orders-to-deliver-ul").prepend("<li><div class='item-content'><div class='item-inner'><div class='item-title'>ORDER #"+s+"</div><div class='item-after'><a href='#' class='button call-agent-btn' phone='"+o+"'><i class='material-icons'>phone</i></a><a href='#' class='button getLocationBtn' latitude='"+i+"' longitude='"+a+"' shopName='"+s+"'><i class='material-icons color-teal'>location_on</i></a></div></div></div></li>")}})}function checkActiveStatus(e,t,i){if("TRIAL"==i){trial=!0;var a=7}else{trial=!1;a=30*parseInt(t)}var o=((Date.now()-parseFloat(e))/864e5).toFixed(0);accountActive=!(o>a),packageSubscribed=i}function getActivationDate(){var e=deviceReady.returnSocket();null!=currentShopId&&""!=currentShopId&&(getServiceAvailable(),e.emit("customerLogin",currentShopId,function(e){checkActiveStatus(e[0].activationDate,e[0].months,e[0].package)}))}function accountIsSuspended(){"customer"!=userLogged?myApp.confirm("Your account is currently running in a free mode. Subscribe to unlock premium features","ACTIVATE PREMIUM MODE",function(e){mainView.router.load({pageName:"select-package-page"})}):showToast("Account is currently not available, Please contact the store admin!")}function getExtraCharges(){deviceReady.returnSocket().emit("getExtraCharges",currentShopId,function(e){extraCharges=e})}function ajaxUpload(e,t,i){var a=new FormData;a.append("fileUrl",e),a.append("filePath",t),$.ajax({url:serverUrl+"upload",type:"POST",data:a,processData:!1,contentType:!1,success:function(e){i(e)}})}function addItemFn(e,t,i,a,o,s,r,n,c,l,d,p){deviceReady.returnSocket().emit("add-item",e,t,i,a,o,"",getTime(),s,r,n,c,l,d,p,function(e,t){200==e?($$(".item-name-input,.item-desc-input,.item-buying-input,.item-selling-input,.item-quantity-input,.item-barcode-input,.item-weight-input").val(""),$$(".media-preview-image").attr("uploadSrc",""),myApp.alert("item was successfully saved!","SUCCESS")):myApp.alert(t,"FAILED"),stopProcess()})}function getReportsFn(){var e,t,i=deviceReady.returnSocket();$$(".sales-report-order-ul").html(""),$$(".todate-total-price,.todate-profit-div").text(0),todateSales=0,todateProfit=0,"ADMIN"==positionLogged?(i.emit("shop-view-reports",shopLogged,function(i,a,o,s){if(customObj=a,i.length>0){for(var r=0;r<i.length;r++){var n=(c=i[r].purchaseDay).slice(0,7);$$(".sales-report-order-ul").prepend("<li purchaseDay='"+c+"' purchaseMonth='"+n+"'><div class='item-content item-link'><div class='item-media'><i class='material-icons color-teal'>today</i></div><div class='item-inner'><div class='item-title'>"+c+"</div><div class='item-after' purchaseDayTotal='"+c+"'>0</div></div></div></li>")}if(a.length>0)for(r=0;r<a.length;r++){var c=a[r].purchaseDay,l=(a[r].id,a[r].shopId,a[r].itemListString,a[r].amount),d=a[r].initAmount;if($("[purchaseDayTotal='"+c+"']").length>0){var p=parseFloat($("[purchaseDayTotal='"+c+"']").text())+parseFloat(l);$("[purchaseDayTotal='"+c+"']").text(p.toFixed(2))}todateSales+=parseFloat(l),todateProfit+=parseFloat(l)-parseFloat(d),$$(".todate-total-price").text(todateSales.toFixed(2)),$$(".todate-profit-div").text(todateProfit.toFixed(2))}}$$(".total-expenses-div").text(getTotals(o).toFixed(2)),$$(".total-damages-div").text(getTotals(s).toFixed(2)),t=s,e=o}),mainView.router.load({pageName:"view-reports-page"})):myApp.alert("This is classified. You are not authorised","PERMISSION DENIED"),$$(document).on("click",".show-expenses-btn",function(t){if(1==accountActive){if($$(".damage-expenses-ul").html(""),mainView.router.load({pageName:"damage-expenses-page"}),$$(".add-damage-expense-btn").attr("title","expenses"),$$(".damage-expenses-header").text("EXPENSES LIST"),e.length>0)for(var i=0;i<e.length;i++){e[i].id;var a=e[i].amount,o=e[i].description,s=e[i].quantity;$$(".damage-expenses-ul").append("<div class='row no-gutter' style='color: #757575;'><div class='col-50' style='border-right: 1px solid #ccc; padding-left: 10px;border-bottom: 1px solid #ccc;'>"+o+"</div><div class='col-25' style='border-right: 1px solid #ccc;border-bottom: 1px solid #ccc;padding-left: 10px;'>"+s+"</div><div class='col-25' style='padding-left: 10px;border-bottom: 1px solid #ccc;'>"+parseFloat(a).toFixed(2)+"</div></div>")}}else accountIsSuspended()}),$$(document).on("click",".show-damages-btn",function(e){if(1==accountActive){if($$(".damage-expenses-ul").html(""),mainView.router.load({pageName:"damage-expenses-page"}),$$(".add-damage-expense-btn").attr("title","damages"),$$(".damage-expenses-header").text("DAMAGED ITEMS LIST"),t.length>0)for(var i=0;i<t.length;i++){t[i].id;var a=t[i].amount,o=t[i].itemName,s=t[i].quantity;$$(".damage-expenses-ul").append("<div class='row no-gutter' style='color: #757575;'><div class='col-50' style='border-right: 1px solid #ccc; padding-left: 10px;border-bottom: 1px solid #ccc;'>"+o+"</div><div class='col-25' style='border-right: 1px solid #ccc;border-bottom: 1px solid #ccc;padding-left: 10px;'>"+s+"</div><div class='col-25' style='padding-left: 10px;border-bottom: 1px solid #ccc;'>"+parseFloat(a).toFixed(2)+"</div></div>")}}else accountIsSuspended()})}function getTotals(e){var t=0;if(e.length>0)for(var i=0;i<e.length;i++)t+=parseFloat(e[i].amount);return t}function getShopUsers(){deviceReady.returnSocket().emit("shop-get-users",currentShopId,function(e){if(stopProcess(),e.length>0)for(var t=0;t<e.length;t++){var i=e[t].fname,a=e[t].position,o=e[t].userId,s=e[t].staffEmail,r=e[t].staffPass;0==$("[id='"+o+"']").length&&("ADMIN"==positionLogged?$$(".shop-users-li").prepend("<div class='card' id='"+o+"' style='box-shadow:none;'><div class='card-header item-title'>"+i+"</div><div class='card-content-inner'><div class='list-block'><ul><li><div class='item-content'><div class='item-inner'><div class='item-title'>POSITION</div><div class='item-after'>"+a+"</div></div></div></li><li><div class='item-content'><div class='item-inner'><div class='item-title'>USER ID</div><div class='item-after'>"+o+"</div></div></div></li><li><div class='item-content'><div class='item-inner'><div class='item-title'>EMAIL</div><div class='item-after'>"+s+"</div></div></div></li><li><div class='item-content'><div class='item-inner'><div class='item-title'>PASSWORD</div><div class='item-after'>"+r+"</div></div></div></li></ul></div></div></div>"):o==loggedUserId&&$$(".shop-users-li").prepend("<div class='card' id='"+o+"' style='box-shadow:none;'><div class='card-header item-title'>"+i+"</div><div class='card-content-inner'><div class='list-block'><ul><li><div class='item-content'><div class='item-inner'><div class='item-title'>POSITION</div><div class='item-after'>"+a+"</div></div></div></li><li><div class='item-content'><div class='item-inner'><div class='item-title'>USER ID</div><div class='item-after'>"+o+"</div></div></div></li><li><div class='item-content'><div class='item-inner'><div class='item-title'>EMAIL</div><div class='item-after'>"+s+"</div></div></div></li><li><div class='item-content'><div class='item-inner'><div class='item-title'>PASSWORD</div><div class='item-after'>"+r+"</div></div></div></li></ul></div></div></div>"))}})}function getInitialData(){if(null!=shopLogged)var e=shopLogged;else e=currentShopId;"BASIC"!=packageSubscribed?checkLogStatus(e,"POS","NO BARCODE"):showToast("UPGRADE TO ADVANCED TO CONTINUE")}function checkItemType(e){if(null!=shopLogged)var t=shopLogged;else t=currentShopId;myApp.actions([[{text:"ITEM HAS BARCODE",onClick:function(){"add"==e?showToast("CONNECT YOUR SMARTPHONE AND PRESS VOLUME UP TO SCAN"):"POS"==e?checkLogStatus(t,e,"BARCODE"):"MANAGE"==e&&scanToManage(t,e)}},{text:"ITEM HAS NO BARCODE",onClick:function(){"add"==e?($$(".item-barcode-input").val("NO BARCODE"),mainView.router.load({pageName:"shop-add-item-page"})):"MANAGE"==e&&(getBarcodeItems(t,e,"NO BARCODE","NO BARCODE"),mainView.router.load({pageName:"shelf"}))}}]])}function duplicateItems(){var e=deviceReady.returnSocket();$$(".shops-to-dup-ul").html(""),myApp.actions([[{text:"<span style='font-size:12px; font-weight:bold;'>USE SHOP ID</span>",onClick:function(){myApp.prompt("Enter the Shop ID associated with the store you want duplicate from or search for it!","ENTER SHOP ID",function(t){e.emit("customerLogin",t,function(e){if(stopProcess(),e.length>0){var i=e[0].shopName;myApp.confirm("Duplicate items from "+i+"?. If you have once duplicated from this store, please find other stores since this will cause multiple duplication of the same item","CONFIRM",function(e){nowDuplicate(t,i)})}else showToast("There is no such ID in our system!")}),processStatus(1e4)})}},{text:"<span style='font-size:12px; font-weight:bold;'>SEARCH INSTEAD</span>",onClick:function(){mainView.router.load({pageName:"shops-to-duplicate-page"}),e.emit("getItemsToDuplicate",function(e){stopProcess(),displayToDuplicate(e)}),processStatus(1e4)}}]])}function displayToDuplicate(e){if(null!==e&&e.length>0)for(var t=0;t<e.length;t++){var i=e[t].shopName,a=e[t].shopId;$$(".shops-to-dup-ul").prepend("<li shopId='"+a+"' shopName='"+i+"'><div class='item-content item-link'><div class='item-media'><i class='material-icons color-teal'>store</i></div><div class='item-inner'><div class='item-title'>"+i+"</div><div class='item-after'></div></div></div></li>")}}function nowDuplicate(e,t){deviceReady.returnSocket().emit("duplicateItems",currentShopId,e,function(e){stopProcess(),e?myApp.alert("You have successfully duplicated items from "+t,"DUPLICATION SUCCESS"):showToast("There was an error while trying to duplicate items!")}),processStatus(1e4)}function scanToManage(e,t){deviceReady.returnSocket();"ADMIN"==positionLogged?(setTimeout(function(){window.plugins.GMVBarcodeScanner.scan({},function(i,a){i?showToast(i):""!=a&&getBarcodeItems(e,t,"BARCODE",a)})},300),$$(".manage-item-review").html("")):myApp.alert("You are not authorized to perform this task!","PERMISSION DENIED")}function getBarcodeItems(e,t,i,a){deviceReady.returnSocket().emit("getItemByBarcode",a,e,function(e){stopProcess(),displayItems(t,i,e)}),processStatus(1e4)}function displayItemsByCategory(e){deviceReady.returnSocket().emit("getItemsByCategory",e,currentShopId,function(e){stopProcess(),displayItems("POS","NO BARCODE",e)}),processStatus(1e4)}function displayItems(e,t,i){if($$(".show-non-barcode-items-ul").html(""),i.length>0){$$(".no-items-div").hide();for(var a=0;a<i.length;a++){var o=i[a].id,s=i[a].itemName,r=i[a].itemDesc,n=i[a].itemSelling,c=i[a].itemQuantity,l=i[a].itemBuying,d=i[a].itemWeight,p=(i[a].category,i[a].itemIcon),m=i[a].special,u=i[a].discount,v=i[a].buyHowMany,h=i[a].getHowMany,g=i[a].specialDue,$=i[a].expiryDate;if(""==p);else;parseFloat(c)>0?"POS"==e&&"BARCODE"==t?(displayItemsOnCart(o,s,r,n,c,l,d,p,m,u,v,h,g,!1),mainView.router.load({pageName:"item-list-page"})):"POS"==e&&"NO BARCODE"==t?displayNonBarcodeItems(o,s,r,n,c,l,d,p,e,m,u,v,h,g,$):"MANAGE"==e&&"BARCODE"==t?displayToManage(o,s,r,n,c,l,d):"MANAGE"==e&&"NO BARCODE"==t&&displayNonBarcodeItems(o,s,r,n,c,l,d,p,e,$):showToast("we do not have "+s+" anymore!")}}else $$(".no-items-div").show()}function isItemSpecial(e,t,i,a,o,s,r){return"DISCOUNT"==t?(amount=(parseFloat(r)-parseFloat(i)/100*parseFloat(r)).toFixed(2),amount+"::"+i):"BUY SOME GET SOME FOR FREE"==t?r+"::"+a+"::"+o:""}function displayNonBarcodeItems(e,t,i,a,o,s,r,n,c,l,d,p,m,u,v){if(""!=l){var h=isItemSpecial(e,l,d,p,m,u,a).split("::");if("DISCOUNT"==l){a=h[0];var g="<span style='color:orange;' class='special-info-btn' title='You have "+d+"% off until "+u+"'>-"+d+"%</span>"}else{a=a;g="<i class='material-icons color-orange special-info-btn' title='Buy "+p+" and get "+m+" for free until "+u+"'>grade</i>"}}else g="";if("POS"==c){var $="<i class='material-icons color-green' style='margin-top:5px;'>add_shopping_cart</i>";g=g}else if("MANAGE"==c){$="<i class='material-icons color-purple' style='margin-top:5px;'>edit</i>";g=""}if(""==n)var y="<i class='material-icons color-teal' style='font-size:80px;'>spa</i>";else y="<img src='"+serverUrl+n+"' style='max-width:100%;' class='itemIcon1'>";$$(".show-non-barcode-items-ul").append("<div class='card shop-list-ul-card' style='width: 150px;border-radius:10px;box-shadow:none;border: 1px solid #ccc;'><div class='card-header view-item-details-btn' style='text-transform: uppercase;color: #757575;font-size: 10px;font-weight: bold;' expiryDate='"+v+"' action='"+c+"' id='"+e+"' itemName='"+t+"' itemDesc='"+i+"' itemSelling='"+a+"' itemQuantity='"+o+"' itemBuying='"+s+"' itemWeight='"+r+"' itemIcon='"+n+"' title"+e+"="+a+" special='"+l+"' buyHowMany='"+p+"' getHowMany='"+m+"' discount='"+d+"' dueDate='"+u+"'>"+g+" "+t.toUpperCase()+"</div><div class='card-content card-content-img1'><center>"+y+"</center></div><div class='card-footer' style='font-weight:bold; font-size:12px;'><a href='#' class='link' style='font-size:10px;font-weight:bold;color:#757575;'>"+parseFloat(a).toFixed(2)+"</a><a href='#' class='link show-non-barcode-items-ul-link' action='"+c+"' id='"+e+"' itemName='"+t+"' itemDesc='"+i+"' itemSelling='"+a+"' itemQuantity='"+o+"' itemBuying='"+s+"' itemWeight='"+r+"' itemIcon='"+n+"' uniqueR='"+e+"' title"+e+"="+a+" special='"+l+"' buyHowMany='"+p+"' getHowMany='"+m+"' discount='"+d+"' dueDate='"+u+"'>"+$+"</a></div></div>")}function displayToManage(e,t,i,a,o,s,r){var n=parseFloat(a)-parseFloat(s);mainView.router.load({pageName:"manage-item-page"}),$$(".manage-item-review").html("<div class='card'><div class='card-header item-title' style='background:#e9eaed;'>"+t+"</div><div class='card-content'><div class='card-content-inner'><div class='list-block'><ul><li><div class='item-content'><div class='item-inner'><div class='item-title'>"+i+"</div></div></div></li><li><div class='item-content'><div class='item-inner'><div class='item-title'>CURRENT COST</div><div class='item-after'>"+currencyCode+" "+parseFloat(a).toFixed(2)+"</div></div></div></li><li><div class='item-content'><div class='item-inner'><div class='item-title'>BUYING PRICE</div><div class='item-after'>"+currencyCode+" "+parseFloat(s).toFixed(2)+"</div></div></div></li><li><div class='item-content'><div class='item-inner'><div class='item-title'>EXPECTED PROFIT</div><div class='item-after'>"+currencyCode+" "+n.toFixed(2)+"</div></div></div></li><li><div class='item-content'><div class='item-inner'><div class='item-title'>ITEMS LEFT</div><div class='item-after'>"+o+"</div></div></div></li></ul></div></div></div><div class='card-footer' style='width:100%;'><div class='row' style='width:100%;'><div class='col-50' style='border-right: 2px solid #e9eaed;'><center><a href='#' class='button remove-item-btn' id="+e+"><i class='material-icons' style='font-size:30px; color: tomato;'>cancel</i></a></center></div><div class='col-50'><center><a href='#' class='button edit-item-btn' id='"+e+"'><i class='material-icons' style='font-size:30px; color: #757575;'>edit</i></a></center></div></div></div></div>"),$$(".edit-item-name-input").val(t),$$(".edit-item-desc-input").val(i),$$(".edit-item-buying-input").val(s),$$(".edit-item-selling-input").val(a),$$(".edit-item-quantity-input").val(o),$$(".proceed-edit-item-btn").attr("id",e)}function addToSpecial(e,t,i){mainView.router.load({pageName:"add-item-special-page"}),$$(".special-item-show-li").text(t+"("+i+")"),$$(".save-special-btn").attr("id",e).attr("itemName",t)}function removeFromSpecial(e,t,i){var a=deviceReady.returnSocket();myApp.confirm("Are you sure you want to remove "+t+" from specials?","CONFIRM SPECIAL",function(i){a.emit("removeFromSpecial",e,function(e){stopProcess(),showToast(e?"You have successfully removed "+t+" from specials!":"Could not remove this item from specials!")}),processStatus(1e4)})}function addItemToDamaged(e,t,i){var a=deviceReady.returnSocket();myApp.prompt("Are you sure you want to add "+t+" to damaged goods? Press proceed to add","ENTER QUANTITY",function(o){""!=o?(i=parseFloat(o)*i,a.emit("addItemToDamaged",currentShopId,e,t,o,i,function(e){stopProcess(),e&&showToast(t+" has been added to damaged goods")}),processStatus(1e4)):showToast("Please enter damaged goods quantity!")})}function formatted_date(e){var t="";if(e.getDate()>9)var i=e.getDate();else i="0"+e.getDate();if(e.getMonth()+1>9)var a=e.getMonth()+1;else a="0"+(e.getMonth()+1);return t+=e.getFullYear()+"-"+a+"-"+i}function displayItemsOnCart(e,t,i,a,o,s,r,n,c,l,d,p,m,u){if(""==n)var v="<i class='material-icons color-teal'>spa</i>";else v="<img src='"+serverUrl+n+"' style='width:30px;border-radius:100%;' class='itemIcon'>";if(""!=c){var h=isItemSpecial(e,c,l,d,p,m,a).split("::");if("DISCOUNT"==c){a=0==u?h[0]:a;var g="<span style='color:orange;' class='special-info-btn' title='You have "+l+"% off until "+m+"'>-"+l+"%</span>"}else{a=a;g="<i class='material-icons color-orange special-info-btn' title='Buy "+d+" and get "+p+" for free until "+m+"'>grade</i>"}}else{g="";a=a}0==$("[id='item-id"+e+"']").length?($$(".item-list-page-content").prepend("<div class='card item-card-show ks-facebook-card' id='item-id"+e+"' style='box-shadow:none;border-radius:10px;border: 1px solid #ccc;'><div class='card-header no-border'><div class='ks-facebook-avatar'>"+v+"</div><div class='ks-facebook-name'>"+g+" "+t.toUpperCase()+"</div></div><div class='card-footer'><a href='#' class='link' style='font-size: 12px; color:#757575;font-weight:bold;' id='quantity-div"+e+"'>1 * "+a+" = "+currencyCode+" "+a+"</a><a href='#' class='link remove-item' id='"+e+"' title"+e+"='"+a+"' itemBuying='"+s+"' itemWeight='"+r+"' itemIcon='"+n+"'><i class='material-icons color-red'>cancel</i></a><a href='#' class='link update-quantity' style='color:#757575;' id="+e+" price='"+a+"' last-total='"+a+"' itemName='"+t+"' itemBuying='"+s+"' itemWeight='"+r+"' itemIcon='"+n+"'><i class='material-icons'>add<sup>remove</sup></i></a></div></div>"),totalCost+=parseFloat(a),totalWeight+=parseFloat(r),totalBuying+=parseFloat(s),$$(".total-cost-div").text(currencyCode+" "+totalCost.toFixed(2)),itemListArray.push({id:e,price:a,totalPrice:a,quantity:1,itemName:t,itemIcon:encodeURIComponent(n)})):showToast("You already have that item on your cart, You may update it instead")}function checkLogStatus(e,t,i){deviceReady.returnSocket();"customer"==userLogged||"POS OPERATOR"==positionLogged||"ADMIN"==positionLogged?("POS OPERATOR"==positionLogged||"ADMIN"==positionLogged)&&""!=currentTill||"customer"==userLogged?"BARCODE"==i?showToast("CONNECT YOUR SMARTPHONE AND PRESS VOLUME UP TO SCAN"):"NO BARCODE"==i&&(getBarcodeItems(e,t,i,"NO BARCODE"),mainView.router.load({pageName:"shelf"})):myApp.prompt("","ENTER YOUR TILL NUMBER",function(e){""!=e&&(currentTill=e)}):myApp.alert("You are not authorized to perform this task!","PERMISSION DENIED")}function scanToAdd(e){var t=deviceReady.returnSocket();"ADMIN"==positionLogged?($$(".item-barcode-input").val(e),mainView.router.load({pageName:"shop-add-item-page"}),t.emit("findBarcodeDetails",e,function(e,t,i,a,o,s){stopProcess(),200==e&&($$(".item-name-input").val(t),$$(".item-desc-input").val(i),$$(".item-buying-input").val(s),$$(".item-selling-input").val(o),$$(".item-weight-input").val(a))}),processStatus(5e3)):myApp.alert("You are not authorized to perform this task!","PERMISSION DENIED")}function updateStore(e,t,i,a,o,s){var r=deviceReady.returnSocket();myApp.confirm("Your store details will be changed?","CONFIRM UPDATE",function(n){1==n&&(r.emit("update-store",e,t,i,a,o,s,function(o){200==o?(myApp.alert("Your store details has been changed","UPDATE SUCCESS"),window.localStorage.setItem("shop-name",i),window.localStorage.setItem("shopDescription",e),window.localStorage.setItem("shopAddress",t),window.localStorage.setItem("shopPassword",a),window.localStorage.setItem("radius",radius),radius=s):myApp.alert("There was an error while trying to update","UPDATE FAILED"),stopProcess()}),processStatus(1e4))})}function updateLocation(e){var t=deviceReady.returnSocket();setTimeout(function(){getGPS(function(e,i){t.emit("updateLocation",e,i,currentShopId);updateLocation(6e5)})},e),null!=userIsDriver&&updateDriverLocation(e)}function updateDriverLocation(e){var t=deviceReady.returnSocket();setTimeout(function(){getGPS(function(e,i){t.emit("updateDriverLocation",e,i,phoneNo,"playerId");updateDriverLocation(18e4)})},e)}function getGPS(e){null==currentLatitude&&null==currentLongitude?navigator.geolocation.getCurrentPosition(function(t){currentLatitude=t.coords.latitude,currentLongitude=t.coords.longitude,e(currentLatitude,currentLongitude)},function(e){},{enableHighAccuracy:!1,timeout:1e4,maximumAge:6e5}):e(currentLatitude,currentLongitude)}function staffLogin(){myApp.modalLogin("","LOGIN BELOW",function(e,t){loginFn(e,t)})}function customerLogin(){var e=deviceReady.returnSocket();myApp.prompt("Enter store id to view their menu","ENTER STORE ID",function(t){e.emit("customerLogin",t,function(e){e.length>0?(loggedInUser=phoneNo,window.localStorage.setItem("loggedInUser",loggedInUser),$$(".companyNameH1").text(e[0].shopName.toUpperCase()),currentShopId=e[0].shopId,currencyCode=e[0].currencyCode,remotePurchase=e[0].remoteOrdering,currentShopName=e[0].shopName,shopLatitude=e[0].latitude,shopLongitude=e[0].longitude,smartDriver=e[0].smartDriver,checkActiveStatus(e[0].activationDate,e[0].months,e[0].package),mainView.router.load({pageName:"smart-order-main"}),isStoreOpen(e[0].workingHours),getRandomItems(),getActivationDate()):myApp.alert("Sorry, We couldn't find any store with the ID you have entered!"),stopProcess()}),processStatus(1e4)})}function loginFn(e,t){deviceReady.returnSocket().emit("loginStaff",e,t,function(i){i.length>0?(userDetails=i,$$(".username-btn").text(userDetails[0].fname),loggedInUser=i[0].staffEmail,window.localStorage.setItem("loggedInUser",e),window.localStorage.setItem("password",t),$$(".companyNameH1").text(userDetails[1].storeName.toUpperCase()),currentShopId=userDetails[0].shopId,currencyCode=userDetails[1].currencyCode,window.localStorage.setItem("currencyCode",currencyCode),mainView.router.load({pageName:"smart-order-main"}),getRandomItems()):myApp.alert("Invalid login credentials."),stopProcess()}),processStatus(1e4)}function getServiceAvailable(){var e=deviceReady.returnSocket();null!==currentShopId&&""!=currentShopId&&e.emit("getServiceAvailable",currencyCode,currentShopId,function(e,t,i){serviceFee="shop"==userLogged?0:parseFloat(e),paypalObj=i,paymentGatewayObj=t})}function getRandomItems(){deviceReady.returnSocket().emit("getSmartRestaurant",currentShopId,function(e){if(viewedItems=e,e.length>0)for(var t=0;t<e.length;t++){var i=e[t].id,a=e[t].itemIcon,o=e[t].itemName,s=e[t].itemSelling,r=(e[t].itemQuantity,e[t].itemDesc,e[t].itemBuying),n=e[t].itemWeight;if(""!=a)var c=serverUrl+a;else c="https://image.iol.co.za/image/1/process/620x349?source=https://cdn.africannewsagency.com/public/ana/media/media/2018/06/20/media-reference%3Aac7696ea3d3c4c2993efe0dfff55520a.jpg&operation=CROP&offset=0x278&resize=5315x2984";$$(".display-items-ul").prepend("<div class='card' all-list-card='"+i+"' style='border-radius:20px;box-shadow:none;'>  <div class='card-header' style='font-size:11px;color:#757575;font-weight:bold;'>"+o.toUpperCase()+" ("+currencyCode+" "+s+")</div>  <div class='card-content card-content-img' id='"+i+"' itemPrice='"+s+"'><center><img src='"+c+"' class='itemIcon'></center></div><div class='card-footer' style='font-size:15px; font-weight:bold;'><a href='#' class='link' itemCostText='id"+i+"' quantity='0' style='font-size:9px;'>"+s+"(0) = 0</a><a href='#' class='link subtract-item-btn' itemIcon='"+a+"' itemBuying='"+r+"' itemWeight='"+n+"' id='"+i+"' itemPrice='"+s+"' quantity='0' itemCost='id"+i+"' itemName='"+o+"'><i class='material-icons' style='margin-top: 7px; color:#757575;'>exposure_neg_1</i></a><a href='#' class='link add-more-item-btn' itemIcon='"+a+"' itemBuying='"+r+"' itemWeight='"+n+"' id='"+i+"' itemPrice='"+s+"' quantity='0' itemCost='id"+i+"' itemName='"+o+"'><i class='material-icons' style='margin-top: 7px; color:#757575;'>exposure_plus_1</i></a><a href='#' class='link remove-smart-item-btn' itemBuying='"+r+"' itemWeight='"+n+"' itemPrice='"+s+"' id='"+i+"' quantity='0' itemCost='id"+i+"'><i class='material-icons' style='margin-top: 7px; color:tomato;'>cancel</i></a></div> </div>")}})}function getCustomerCare(){var e=deviceReady.returnSocket();$$(".customer-care-ul").html(""),e.emit("getCustomerCare",currentShopId,function(e){if(e.length>0)for(var t=0;t<e.length;t++){var i=e[t].fname,a=e[t].staffPhone;$$(".customer-care-ul").prepend("<li><div class='item-content'><div class='item-media'><i class='material-icons color-teal'>person_outline</i></div><div class='item-inner'><div class='item-title'>"+i+"</div><div class='item-after'><a href='#' class='button whatsApp-btn' phoneNo='"+a+"' fname='"+i+"'><img src='images/whatsapp.png' style='width:18px;'></a></div></div></div></li>")}})}function getShopGeo(e){deviceReady.returnSocket().emit("customerLogin",e,function(e){getDirection(e[0].latitude,e[0].longitude,e[0].shopName)})}function cancelThisJob(e){var t=deviceReady.returnSocket();myApp.confirm("Are you sure you want to cancel this Job? Punishment fees may apply?","CONFIRM UPDATE",function(i){t.emit("driverCancelJob",e,phoneNo,function(e){stopProcess(),showToast("Job cancelled successfully!")}),processStatus(1e4)})}function markAsDelivered(e,t,i){var a=deviceReady.returnSocket();myApp.confirm("Press proceed then wait for the purchaser to confirm delivery. After confirmation, collect "+myCurrencyCode+" "+parseFloat(t).toFixed(2)+" from the purchaser","MARK THIS JOB AS DONE",function(o){a.emit("driverMarkJobAsDone",e,i,t,phoneNo),processStatus(6e4)})}function confirmDelivery(e,t,i){deviceReady.returnSocket().emit("buyerConfirmDelivery",e,t,i,function(e){stopProcess(),e?myApp.alert("Thank you for confirming your order. Please pay "+parseFloat(t).toFixed(2)+" to the driver","ORDER CONFIRMED"):showToast("There was an error while trying to confirm this order!")}),processStatus(1e4)}function driverAcceptJob(e,t){var i=deviceReady.returnSocket();myApp.confirm("Once the purchaser confirms the delivery you will be rewarded with "+myCurrencyCode+" "+parseFloat(t).toFixed(2)+". Click on the pickup location button for directions","ACCEPT THIS JOB",function(t){i.emit("driverAcceptJob",e,phoneNo,function(e){stopProcess(),showToast(e?"Congrats, The job is yours. Quickly deliver to the drop location to proceed to the next job!":"Oops, your application was not success!")}),processStatus(1e4)})}function getOrders(e){var t=deviceReady.returnSocket();$$(".card-show-bodies-ul,.show-mini-order-ul").html(""),$$(".waiting-order-div").show(),$$(".order-card").hide(),"getOrdersShop"==e?($$(".mark-as-ready-btn,.mark-as-paid-btn").show(),$$(".mark-as-delivered-btn").hide()):($$(".mark-as-ready-btn,.mark-as-paid-btn").hide(),$$(".mark-as-delivered-btn").show()),t.emit(e,currentShopId,phoneNo,function(e){if(e.length>0)for(var t=0;t<e.length;t++){displayOrders(e[t].id,e[t].itemListString,e[t].amount,e[t].status,e[t].location,"old",e[t].latitude,e[t].longitude,e[t].paidFor,e[t].shopId,e[t].shopName,e[t].deliverer,e[t].buyerNumber)}})}function displayOrders(e,t,i,a,o,s,r,n,c,l,d,p,m){o="remote"==o?"REMOTE":"local"==o?"LOCAL":"TABLE "+o,"COLLECTED"==a?(statusDiv="<i class='material-icons color-teal' style='font-size:14px;'>check_circle</i>",statusDiv1="<i class='material-icons color-teal' style='margin-right:5px;'>check_circle</i>"):"READY"==a?(statusDiv="<i class='material-icons color-orange' style='font-size:14px;'>done</i>",statusDiv1="<i class='material-icons color-orange' style='margin-right:5px;'>done</i>"):"PICKED"==a?(statusDiv="<i class='material-icons color-orange' style='font-size:14px;'>directions_car</i>",statusDiv1="<i class='material-icons color-orange' style='margin-right:5px;'>directions_car</i>"):(statusDiv="<i class='material-icons' style='font-size:14px;color:tomato;'>lens</i>",statusDiv1="<i class='material-icons' style='color:tomato;margin-right:5px;'>lens</i>"),paidForDiv="PAID"==c?"<i class='material-icons color-teal' style='font-size:14px;'>check_circle</i>":"<i class='material-icons' style='font-size:14px;color:tomato;'>lens</i>","shop"!=userLogged&&(getShopDetails(l),o=d.split(" ")[0]),$$(".card-show-bodies-ul").append("<div class='row no-gutter no-gutter-big' style='color: #757575;' buyerNumber='"+m+"' latitude='"+r+"' longitude='"+n+"' deliverer='"+p+"' paidFor='"+c+"' order='id"+e+"' id='"+e+"' orderObj='"+t+"' total='"+i+"' location='"+o+"' status='"+a+"'><div class='col-25' style='border-right: 1px solid #ccc; padding-left: 10px;border-bottom: 1px solid #ccc;'>"+e+"</div><div class='col-35' style='border-right: 1px solid #ccc;border-bottom: 1px solid #ccc;padding-left: 10px;' fromShop='"+l+"'>"+o+"</div><div class='col-25' style='border-right: 1px solid #ccc;border-bottom: 1px solid #ccc;padding-left: 10px;'>"+statusDiv+"</div><div class='col-15' style='padding-left: 10px;border-bottom: 1px solid #ccc;'>"+paidForDiv+"</div></div>"),$(".show-mini-order-ul li").length<9&&$$(".show-mini-order-ul").append("<li class='no-gutter-big' deliverer='"+p+"' buyerNumber='"+m+"' latitude='"+r+"' longitude='"+n+"' paidFor='"+c+"' order='id"+e+"' id='"+e+"' orderObj='"+t+"' total='"+i+"' location='"+o+"' status='"+a+"'><div class='item-content'><div class='item-inner'><div class='item-title' style='font-size:13px;color:#757575;'>"+currencyCode+" "+parseFloat(i).toFixed(2)+"</div></div><div class='item-after'><i class='material-icons color-teal'>"+statusDiv1+"</i></div></div></li>")}function getShopDetails(e){deviceReady.returnSocket().emit("customerLogin",e,function(e){currencyCode=e[0].currencyCode})}function reverseGeoCode(e,t,i){var a="https://maps.googleapis.com/maps/api/geocode/json?latlng="+e+","+t+"&sensor=true&key=AIzaSyCX4BPLJ1EoHgY9LaDTfciCb3tidpIijPk",o=new FormData;$.ajax({url:a,type:"POST",data:o,processData:!1,contentType:!1,success:function(e){i(e.results[0].formatted_address)}})}function updateOrder(e,t,i,a,o){"status"==i&&"shop"==userLogged?selectDeliverer(e,t,i,a):changeOrderStatus(e,t,i,a,o)}function selectDeliverer(e,t,i,a){myApp.actions([[{text:"SMARTSTORE DELIVERERS",onClick:function(){changeOrderStatus(e,t,i,a,"SMARTSTORE")}},{text:"OUR OWN DELIVERERS",onClick:function(){changeOrderStatus(e,t,i,a,"OUR OWN")}}]])}function changeOrderStatus(e,t,i,a,o){var s=deviceReady.returnSocket();myApp.confirm(a,"CONFIRM UPDATE",function(a){s.emit("changeOrderStatus",e,i,t,o,function(i){i?(showToast("Order "+e+" has been marked as "+t.toLowerCase()+"!"),getOrders()):showToast("Sorry we could not update this order!"),stopProcess()}),processStatus(1e4)})}function getLocalStores(){var e=deviceReady.returnSocket();setTimeout(function(){getGPS(function(t,i){e.emit("getLocalStores",t,i,function(e){stopProcess(),displayLocalStores(e)})})},3e3),processStatus(15e3)}function displayLocalStores(e){if($$(".shop-list-ul-center").html(""),e.length>0)for(var t=0;t<e.length;t++){var i=e[t].shopName,a=e[t].shopId,o=(e[t].latitude,e[t].longitude,e[t].staffPhone,e[t].shopCategory);$$(".shop-list-ul-center").append("<div class='card shop-list-ul-card go-to-shop-panel-btn' shopId='"+a+"' style='width: 150px;border-radius:10px;box-shadow:none;border: 1px solid #ccc;'><div class='card-header' style='text-transform: uppercase;color: #757575;font-size: 10px;font-weight: bold;'>"+i+"</div><div class='card-content'><div class='card-content-inner'><center><i class='material-icons color-teal' style='font-size:50px;'>shopping_cart</i></center></div></div><div class='card-footer' style='font-weight:bold; font-size:12px;'>"+o.toUpperCase()+"</div></div>")}else $$(".shop-list-ul-center").html("<div class='content-block'><center><i class='material-icons color-gray' style='font-size:200px;'>cloud_queue</i></center><center><h3><i style='color:#757575;'>WE COULD NOT FIND NEARBY STORES. MAKE SURE TO TURN ON LOCATION</i></h3></center></div>")}function selfLogin(e,t){deviceReady.returnSocket().emit("getShopDetails",e,function(i,a,o,s,r,n,c,l,d,p,m,u){stopProcess(),0!=i?(currentShopId=e,currentShopName=a,shopDescription=o,smartDriver=u,checkActiveStatus(s,r,n),$$(".shopNameShow").text(a.toUpperCase()),currencyCode=c,itemListArray=[],totalCost=0,totalBuying=0,totalWeight=0,$$(".total-cost-div,.all-total-cost-div,.after-items-price,.after-delivery-fee,.after-service-fee").text(currencyCode+"0.00"),$$(".item-card-show").remove(),shopLatitude=d,shopLongitude=p,remotePurchase=l,$$(".moto-label-shop").text("welcome to "+a+", Please enjoy your shopping"),"normal"==t?(mainView.router.load({pageName:"shelf"}),getInitialData(),getCustomerCare()):(getInitialData(),displayItemsByCategory("SPECIALS")),loggedIn=!0,getActivationDate(),$$(".shop-account-ul-btn").show(),$$(".shop-account-btn").text("ACCOUNT BAL").attr("shopName",a),isStoreOpen(m)):showToast("The shop ID you have entered does not exist!")}),processStatus(1e4)}function getDistance(e,t,i,a){var o=toRad(i-e),s=toRad(a-t),r=(e=toRad(e),i=toRad(i),Math.sin(o/2)*Math.sin(o/2)+Math.sin(s/2)*Math.sin(s/2)*Math.cos(e)*Math.cos(i));return 6371*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))}function toRad(e){return e*Math.PI/180}function getAccountBalance(){var e=deviceReady.returnSocket();$$(".savings-account-name-div").text("ACCOUNT BALANCE"),e.emit("getThisShopAccountBalance",phoneNo,currentShopId,function(e){e.length>0?($$(".show-my-account-bal-div").html(currencyCode+" "+parseFloat(e[0].balance).toFixed(2)),accountBal=parseFloat(e[0].balance).toFixed(2)):($$(".show-my-account-bal-div").html(currencyCode+" 0.00"),accountBal=0)})}function pawnOrSellFn(e){var t=deviceReady.returnSocket();$$(".pawnOrSell-div-toggle").show(),mainView.router.load({pageName:"pawnOrSell-page"}),$$(".pawnOrSell-div").text("YOUR "+e+" LIST"),$$(".add-pawnOrSell-div").text(e+" YOUR ITEM"),$$(".add-pawnOrSell-btn").attr("title",e),$$(".pawn-sell-list-ul").html(""),$$(document).on("change",".select-get-category-input",function(i){$$(".pawn-sell-list-ul").html("");var a=$$(this).val();t.emit("getPawnSell",phoneNo,e,a,function(t){if(t.length>0)for(var i=0;i<t.length;i++)!function(a){setTimeout(function(){var i=t[a].itemName,o=t[a].itemDec,s=t[a].itemIcon;s=serverUrl+s;var r=t[a].expectedCash,n=t[a].status,c=t[a].id,l=t[a].date,d=t[a].itemOwner;0!=$(".rm-second-col").length?($$(".rm-second-col").html("<div class='card open-popover pawnOrSell-option-btn' style='border-radius:20px;box-shadow:none;' itemOwner='"+d+"' uniqueLI='"+c+"' id='"+c+"' date='"+l+"' status='"+n+"' pawnOrSell='"+e+"' expectedCash='"+r+"' data-popover='.popover-pawnOrSell' itemName='"+i+"' itemDesc='"+o+"' itemIcon='"+s+"'><div class='card-header' style='color:#757575;font-weight:bold;font-size:10px;'>"+i.toUpperCase()+"</div><div class='card-content card-content-img1'><center><img src='"+s+"' class='itemIcon1'></center></div><div class='card-footer'><a href='#' class='link' style='font-size:9px;'>"+parseFloat(r).toFixed(2)+"</a><a href='#' class='link' id='bid-span"+c+"' style='font-size:9px;'>"+n+"</a></div></div>"),$$(".second-col").removeClass("rm-second-col")):$$(".pawn-sell-list-ul").append("<div class='row'> <div class='col-50'><div class='card open-popover pawnOrSell-option-btn' style='border-radius:20px;box-shadow:none;' itemOwner='"+d+"' uniqueLI='"+c+"' id='"+c+"' date='"+l+"' status='"+n+"' pawnOrSell='"+e+"' expectedCash='"+r+"' data-popover='.popover-pawnOrSell' itemName='"+i+"' itemDesc='"+o+"' itemIcon='"+s+"'> <div class='card-header' style='color:#757575;font-weight:bold;font-size:10px;'>"+i.toUpperCase()+"</div><div class='card-content card-content-img1'><center><img src='"+s+"' class='itemIcon1'></center></div><div class='card-footer'><a href='#' class='link' style='font-size:9px;'>"+parseFloat(r).toFixed(2)+"</a><a href='#' class='link' id='bid-span"+c+"' style='font-size:9px;'>"+n+"</a></div></div></div>  <div class='col-50 second-col rm-second-col'></div>"),"RUNNING"==n&&getBids(c)},500*i)}(i)})})}function shopPawnOrSellFn(e){var t=deviceReady.returnSocket();mainView.router.load({pageName:"pawnOrSell-page"}),$$(".pawnOrSell-div-toggle").hide(),$$(".pawnOrSell-div").text(e+" ITEMS"),e="BUY"==e?"SELL":e,$$(".pawn-sell-list-ul").html(""),$$(document).on("change",".select-get-category-input",function(i){$$(".pawn-sell-list-ul").html("");var a=$$(this).val();getGPS(function(i,o){t.emit("getPawnBuy",i,o,e,radius,a,function(t){if(t.length>0)for(var i=0;i<t.length;i++)!function(a){setTimeout(function(){var i=t[a].itemName,o=t[a].itemDec,s=t[a].itemIcon;s=serverUrl+s;var r=t[a].expectedCash,n=t[a].status,c=t[a].id,l=t[a].date,d=t[a].itemOwner;0!=$(".rm-second-col").length?($$(".rm-second-col").html("<div class='card open-popover pawnOrSell-option-btn' style='border-radius:20px;box-shadow:none;' itemOwner='"+d+"' uniqueLI='"+c+"' id='"+c+"' date='"+l+"' status='"+n+"' pawnOrSell='"+e+"' expectedCash='"+r+"' data-popover='.popover-shopPawnOrSell' itemName='"+i+"' itemDesc='"+o+"' itemIcon='"+s+"'><div class='card-header' style='color:#757575;font-weight:bold;font-size:10px;'>"+i.toUpperCase()+"</div><div class='card-content card-content-img1'><center><img src='"+s+"' class='itemIcon1'></center></div><div class='card-footer'><a href='#' class='link' style='font-size:9px;'>"+parseFloat(r).toFixed(2)+"</a><a href='#' class='link' id='bid-span"+c+"' style='font-size:9px;'>"+n+"</a></div></div>"),$$(".second-col").removeClass("rm-second-col")):$$(".pawn-sell-list-ul").append("<div class='row'> <div class='col-50'><div class='card open-popover pawnOrSell-option-btn' style='border-radius:20px;box-shadow:none;' itemOwner='"+d+"' uniqueLI='"+c+"' id='"+c+"' date='"+l+"' status='"+n+"' pawnOrSell='"+e+"' expectedCash='"+r+"' data-popover='.popover-shopPawnOrSell' itemName='"+i+"' itemDesc='"+o+"' itemIcon='"+s+"'> <div class='card-header' style='color:#757575;font-weight:bold;font-size:10px;'>"+i.toUpperCase()+"</div><div class='card-content card-content-img1'><center><img src='"+s+"' class='itemIcon1'></center></div><div class='card-footer'><a href='#' class='link' style='font-size:9px;'>"+parseFloat(r).toFixed(2)+"</a><a href='#' class='link' id='bid-span"+c+"' style='font-size:9px;'>"+n+"</a></div></div></div>  <div class='col-50 second-col rm-second-col'></div>"),getBids(c)},500*i)}(i)})})})}function getBids(e){deviceReady.returnSocket().emit("getBids",e,function(t){t.length>0&&($$("[id='bid-span"+e+"']").html("BIDS ("+t.length+")"),$$("[uniqueLI='"+e+"']").attr("result",t))})}function placeBid(e,t,i,a,o,s,r,n){mainView.router.load({pageName:"pawn-sell-place-bid-page"}),$$(".place-bid-item-name").text(e.toUpperCase()),$$(".bid-offer-input").val(t),$$(".place-bid-btn").attr("id",o).attr("pawnOrSell",n),"PAWN"==n?$$(".bid-interest-li").show():$$(".bid-interest-li").hide(),$$(".place-bid-item-expected-cash").text(parseFloat(t).toFixed(2))}function placeBidNow(e,t,i,a){var o=deviceReady.returnSocket();getGPS(function(a,s){o.emit("placeBid",e,t,i,a,s,currentShopId,function(e){stopProcess(),1==e?(showToast("Your bid has been placed!, You can now wait for a response from the item owner!"),window.history.back()):showToast("Error while trying to place your bid!")})}),processStatus(2e4)}function viewBids(e,t,i,a){var o=deviceReady.returnSocket();mainView.router.load({pageName:"pawn-sell-bids-page"}),$$(".pawnOrSell-bid-div").text(t.toUpperCase()+" ("+parseFloat(i).toFixed(2)+")"),$$(".pawn-sell-bids-list-ul").html(""),o.emit("getBids",e,function(t){if(t.length>0){$$("[id='bid-span"+e+"']").html("BIDS ("+t.length+")");for(var i=0;i<t.length;i++){var o=t[i].shopName,s=t[i].staffPhone,r=t[i].shopId,n=t[i].offers,c=t[i].interest,l=t[i].latitude,d=t[i].longitude,p=(parseFloat(c)/100*parseFloat(n)+parseFloat(n)).toFixed(2);"PAWN"==a?$$(".pawn-sell-bids-list-ul").prepend("<li pawnOrSell='"+a+"' id='"+e+"' staffPhone='"+s+"' interest='"+c+"' shopName='"+o+"' shopId='"+r+"' latitude='"+l+"' longitude='"+d+"' toPay='"+p+"' offers='"+n+"' data-popover='.popover-bid-pawnOrSell' class='open-popover pawnOrSell-bid-option-btn'><a href='#' class='item-link item-content'><div class='item-media'><i class='material-icons color-teal'>business</i></div><div class='item-inner'><div class='item-title-row'><div class='item-title' style='font-size:12px;'>"+o+"</div><div class='item-after'>"+p+"</div></div><div class='item-subtitle'><span class='bid-span'>INTEREST ("+c+"%)</span><span class='price-span' style='margin-left:20px;'>OFFERS ("+parseFloat(n).toFixed(2)+")</span></div></div></a></li>"):$$(".pawn-sell-bids-list-ul").prepend("<li pawnOrSell='"+a+"' id='"+e+"' staffPhone='"+s+"' interest='"+c+"' shopName='"+o+"' shopId='"+r+"' latitude='"+l+"' longitude='"+d+"' toPay='"+p+"' offers='"+n+"' data-popover='.popover-bid-pawnOrSell' class='open-popover pawnOrSell-bid-option-btn'><a href='#' class='item-link item-content'><div class='item-media'><i class='material-icons color-teal'>business</i></div><div class='item-inner'><div class='item-title-row'><div class='item-title' style='font-size:12px;'>"+o+"</div><div class='item-after'>OFFERS "+parseFloat(n).toFixed(2)+"</div></div></div></a></li>")}}})}function getDirection(e,t,i){var a=parseFloat(e)+","+parseFloat(t);window.open("geo:0,0?q="+a+"("+i+")","_system")}function acceptBid(e,t,i,a,o,s){var r=deviceReady.returnSocket();if("PAWN")var n="You will be offered "+parseFloat(t).toFixed(2)+" Then pay "+parseFloat(o).toFixed(2)+" after 30 days to reclaim your item!";else n="Click accept button to accept an offer of "+parseFloat(t).toFixed(2);myApp.confirm(n,"ACCEPT BID ?",function(i){r.emit("acceptBid",e,t,a,o,function(e){stopProcess(),showToast(1==e?"Bid has been accepted!":"There was an error, while trying to accept bid!")}),processStatus(1e4)})}function terminatePawnSell(e,t,i,a,o,s,r,n){var c=deviceReady.returnSocket();myApp.confirm("Your item will be removed from the list","TERMINATE YOUR "+n+"?",function(e){c.emit("terminatePawnSell",o,function(e){stopProcess(),e?(showToast("Your item has been deleted"),$$("[uniqueLI='"+o+"']").remove()):showToast("There was an error, while trying to delete your item!")}),processStatus(1e4)})}function getNearByAgents(e,t,i,a,o,s,r,n){var c=deviceReady.returnSocket();$$(".hide-on-agents").hide(),mainView.router.load({pageName:"pawnOrSell-nearby-page"}),$$(".local-store-agents").text("LOCAL AGENCIES"),$$(".pawn-sell-nearby-ul").html(""),getGPS(function(e,t){c.emit("getNearByAgents",e,t,function(e){if(stopProcess(),e.length>0)for(var t=0;t<e.length;t++){var i=e[t].shopName,a=e[t].latitude,o=e[t].longitude,s=e[t].staffPhone;$$(".pawn-sell-nearby-ul").prepend("<li><div class='item-content'><div class='item-inner'><div class='item-title'>"+i+"</div><div class='item-after'><a href='#' class='button call-agent-btn' phone='"+s+"'><i class='material-icons'>phone</i></a><a href='#' class='button getLocationBtn' latitude='"+a+"' longitude='"+o+"' shopName='"+i+"'><i class='material-icons'>location_on</i></a></div></div></div></li>")}})}),processStatus(3e4)}function viewPawnSellDetails(e,t,i,a,o,s,r,n){mainView.router.load({pageName:"pawnOrSell-details-page"}),$$(".pawnOrSell-item-div").text(e.toUpperCase()+" DETAILS"),$$(".show-pawnSellDetails-div").html("<div class='card'><div class='card-header' style='font-weight:bold;color:#757575;'>"+e.toUpperCase()+"</div><div class='card-content'><center><img src="+a+" class='itemIcon1' style='max-width:98%;border-radius:3px;'></center></div><div class='card-content list-block'><ul> <li><div class='item-content item-link'><div class='item-media'><i class='material-icons color-teal'>lens</i></div><div class='item-inner'><div class='item-title'>STATUS</div><div class='item-after'>"+r+"</div></div></div></li><li><div class='item-content item-link'><div class='item-media'><i class='material-icons color-teal'>lens</i></div><div class='item-inner'><div class='item-title'>EXPECTED CASH</div><div class='item-after'>"+parseFloat(t).toFixed(2)+"</div></div></div></li> </ul></div><div class='card-content'><div class='card-content-inner'>"+i+"</div></div></div>")}function base64Mime(e){var t=null;if("string"!=typeof e)return t;var i=e.match(/data:([a-zA-Z0-9]+\/[a-zA-Z0-9-.+]+).*,.*/);return i&&i.length&&(t=i[1]),t}function openGallery(){navigator.camera.getPicture(function(e){e="file://"+e,plugins.crop(function(e){$(".media-preview-image").attr("src",window.Ionic.WebView.convertFileSrc(e)).attr("uploadSrc",e),mainView.router.load({pageName:"media-preview-page"})},function(){},e,{quality:100})},null,{quality:100,destinationType:Camera.DestinationType.FILE_URL,sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,mediaType:Camera.MediaType.ALLMEDIA,allowEdit:!0,targetWidth:800,targetHeight:800})}function openCamera(){navigator.camera.getPicture(function(e){plugins.crop(function(e){$(".media-preview-image").attr("src",window.Ionic.WebView.convertFileSrc(e)).attr("uploadSrc",e),mainView.router.load({pageName:"media-preview-page"})},function(){},e,{quality:100})},null,{quality:50,destinationType:Camera.DestinationType.FILE_URL})}function selectPurchaseLocation(e){1==openStatus?myApp.actions([[{text:"<span style='border-bottom: 1px solid #ccc;'>HOW WOULD YOU LIKE TO PURCHASE?</span>",label:!0},{text:"<span style='font-size:12px; font-weight:bold;'>SELF-CHECKOUT</span>",onClick:function(){finishPayments("local",e)}},{text:"<span style='font-size:12px; font-weight:bold;'>REMOTE PURCHASE</span>",onClick:function(){"TRUE"==remotePurchase?finishPayments("remote",e):showToast("This store does not allow remote ordering!")}}]]):showToast("This store is currently closed, please try again later!")}function finishPayments(e,t){if(getAccountBalance(),"remote"==e){var i=4*serviceFee,a=4*parseFloat(serviceFee)*3;if("TRUE"==smartDriver){if(distanceFromStore<8)a=a;else if(distanceFromStore>=8){a+=(distanceFromStore-7)*serviceFee}}else a=0}else i=2*serviceFee,a=0;i+=.15*(deliveryFee=.85*a),$$(".after-items-price").text(currencyCode+" "+totalCost.toFixed(2)),$$(".after-delivery-fee").text(currencyCode+" "+deliveryFee.toFixed(2)),$$(".after-service-fee").text(currencyCode+" "+i.toFixed(2));var o=(totalCost+i+deliveryFee).toFixed(2);$$(".all-total-cost-div").text(currencyCode+" "+o),"remote"==e?$$(".payment-note-div").html("<center>YOU PAY "+currencyCode+" "+(i+totalCost).toFixed(2)+" NOW AND THEN PAY "+currencyCode+" "+deliveryFee.toFixed(2)+" IN CASH TO THE DRIVER AFTER RECEIVING YOUR ORDER</center>"):$$(".payment-note-div").html(""),"local"==e&&"smartRestaurant"==t?myApp.prompt("Enter table number for easy identification","ENTER TABLE NUMBER",function(e){""!=e&&$$(".cash-payment-btn,.pay-later-btn").show()}):"remote"==e&&"smartRestaurant"==t?$$(".cash-payment-btn,.pay-later-btn").hide():"local"==e&&"smartStore"==t?($$(".pay-later-btn").hide(),$$(".cash-payment-btn").show()):"remote"==e&&"smartStore"==t&&$$(".cash-payment-btn,.pay-later-btn").hide(),$$(".payment-ul shop-list-ul-card").attr("location",e).attr("latitude",0).attr("longitude",0).attr("option",t).attr("deliveryFee",deliveryFee)}function requestForCashier(e,t,i,a,o,s,r,n,c,l){var d=deviceReady.returnSocket(),p=paymentGatewayObj[0].otherKey,m=JSON.stringify(itemListArray);d.emit("requestForCashier",l,t,i,a,currentShopId,m,loggedInUser,totalBuying,formatted_date(new Date),totalWeight,currencyCode,p,o,s,r,n,c)}function getQuantity(e){if(!(itemListArray.length>0))return 0;for(var t=0;t<itemListArray.length;t++){var i=itemListArray[t].id,a=itemListArray[t].quantity;return i==e?a:0}}function getLocalItems(e,t,i){for(var a=0;a<t.length;a++){var o=t[a].id,s=t[a].itemIcon,r=t[a].itemName,n=t[a].itemSelling,c=(t[a].itemQuantity,t[a].itemDes,t[a].itemBuying),l=t[a].itemWeight;if(o==e){if("itemName"==i)return r;if("itemPrice"==i)return n;if("itemIcon"==i)return s;if("itemBuying"==i)return c;if("itemWeight"==i)return l}}}myApp.onPageReinit("welcome-page",function(e){setTimeout(function(){null!=shopLogged?(mainView.router.load({pageName:"shop-main-page"}),userLogged="shop",currentShopId=shopLogged):userLogged="customer",getActivationDate(),$$(".shop-account-ul-btn").hide()},1e3)}),$(document).ready(deviceReady()),$$(document).on("click",".getLocationBtn",function(e){getDirection($$(this).attr("latitude"),$$(this).attr("longitude"),$$(this).attr("shopName"))}),$$(document).on("click",".log-out-btn",function(e){myApp.confirm("You will be required to enter your store credentials and your user ID to gain access on your next login","CONFIRM LOG OUT",function(e){window.localStorage.removeItem("shop-id"),window.localStorage.removeItem("positionLogged"),window.localStorage.removeItem("currencyCode"),shopLogged=null,positionLogged=null,window.location="index.html"})}),$$(document).on("click",".looking-for-page-btn",function(e){null!=phoneNo?mainView.router.load({pageName:"looking-for-page"}):changeNumber()}),$$(document).on("change",".option-goBack",function(e){window.history.back()}),$$(document).on("click",".go-back-btn",function(e){window.history.back()}),$$(document).on("click",".account-edit-btn",function(e){var t=deviceReady.returnSocket();mainView.router.load({pageName:"edit-shop-page"}),"ADMIN"==positionLogged?t.emit("customerLogin",currentShopId,function(e){checkActiveStatus(e[0].activationDate,e[0].months,e[0].package),"TRIAL"==e[0].package?$$(".update-package-select").text(e[0].package.toUpperCase()+" PACKAGE ("+e[0].months+" days)"):$$(".update-package-select").text(e[0].package.toUpperCase()+" PACKAGE ("+e[0].months+" months)"),$$(".operational-radius-input").val(e[0].operationalRadius),$$(".shop-description-input-edit").val(e[0].shopDes.toUpperCase()),$$(".shop-name-input-edit").val(e[0].shopName.toUpperCase()),$$(".shop-address-input-edit").val(e[0].shopAddress.toUpperCase()),$$(".shop-password-input-edit").val(e[0].password),$$(".shop-verify-input-edit").val(e[0].password),"TRUE"==e[0].remoteOrdering?$$("[title='online-store-checkbox']").attr("checked","checked"):$$("[title='online-store-checkbox']").removeAttr("checked"),"TRUE"==e[0].pawnBuy?$$("[title='pawn-buy-checkbox']").attr("checked","checked"):$$("[title='pawn-buy-checkbox']").removeAttr("checked"),"TRUE"==e[0].smartDriver?$$("[title='own-drivers-checkbox']").attr("checked","checked"):$$("[title='own-drivers-checkbox']").removeAttr("checked")}):myApp.alert("This is classified. You are not authorised","PERMISSION DENIED")}),$$(document).on("click",".enter-shop-id-btn",function(e){null!=phoneNo?myApp.prompt("You will be able to buy goods from this shop id","ENTER SHOP ID",function(e){""!=e?selfLogin(e,"normal"):showToast("Please enter shop ID!")},function(){$(".nearby-stores-btn").click()}):changeNumber()}),$$(document).on("click",".update-phoneNo-btn",function(e){deviceReady.returnSocket();var t=$$(".customer-phone-input").val(),i=$$(".customer-address-input").val(),a="+"+$$(".select-country-cus-code-input").val();if(filter.test(t)){t=a+""+phoneNoValidation(t)}else{t=t}""!=i?myApp.confirm("Is your delivery address "+i+" and your contact "+t+"? ","CONFIRM SHIPMENT DETAILS",function(){""!=t?(geoCodeAddress(i,function(e,i){stopProcess(),deliveryLat=e,deliveryLng=i,distanceFromStore=getDistance(e,i,shopLatitude,shopLongitude).toFixed(1),loggedInUser=t,phoneNo=phoneNo,finishPayments("remote","smartStore"),mainView.router.load({pageName:"total-payment-details-page"})}),processStatus(1e4)):showToast("Please provide contact details.","CONTACT DETAILS REQUIRED")}):showToast("Please enter your delivery Address!")}),$$(document).on("click",".change-number-btn",function(e){changeNumber()}),$$(document).on("click",".confirm-code-btn",function(e){var t=$$(".confirmation-code-input").val(),i=$$(this).attr("phone"),a=$$(this).attr("code"),o=deviceReady.returnSocket(),s="+"+$$(".select-country-cus-code-input").val(),r=$$(".customer-address-input").val();t.length>4?parseInt(t)==parseInt(a)?(getGPS(function(e,t){o.emit("updatePhone",i,s,r,e,t,function(e,t){stopProcess(),1==e?(phoneNo=i,myCurrencyCode=t,window.localStorage.setItem("phoneNo",i),window.localStorage.setItem("currency_code",t),window.localStorage.setItem("deliveryAddress",r),showToast("Your customer details has been saved!"),$$(".customer-phone-input").val(""),window.history.back(2)):showToast("Oops, there was an error while trying to save your phone number!")})}),processStatus(15e3)):showToast("You have provided an invalid confirmation code!"):showToast("There is an error with your code!")}),$$(document).on("click",".payment-history-btn",function(e){var t=deviceReady.returnSocket();mainView.router.load({pageName:"payment-history-page"}),t.emit("get-payment-history",phoneNo,userLogged,currentShopId)}),$$(document).on("click",".go-to-cart-btn",function(e){1==loggedIn&&mainView.router.load({pageName:"item-list-page"})}),$$(document).on("click",".go-to-cart-btn1",function(e){itemListArray.length>0?mainView.router.load({pageName:"item-list-page"}):showToast("Cart is empty. Select items to proceed!")}),$$(document).on("click",".list-shopid-ul li",function(e){var t=deviceReady.returnSocket(),i=$$(this).attr("itemListString"),a=$$(this).attr("orderNumber"),o=$$(this).attr("totalPrice"),s=$$(this).attr("weight"),r=$$(this).attr("shopId");mainView.router.load({pageName:"order-details-page"}),$$(".order-number-div").text("RECEIPT #"+a),$$(".customer-sales-show-div").show(),$$(".shop-sales-show-div").hide(),$$(".order-total-price").html(parseFloat(o).toFixed(2));var n=JSON.parse(i);$("[item-list-receipt='same-same']").remove();var c=(parseFloat(s)/1e3).toFixed(3);$$(".show-order-total-weight-sec").html(c+" KG");for(var l=0;l<n.length;l++)!function(e){setTimeout(function(){var i=n[e].price,a=n[e].itemName,o=n[e].quantity,s=n[e].id;t.emit("getItemOfSameMass",r,s,function(e){1==e?$$(".order-item-ul").prepend("<li item-list-receipt='same-same'><div class='item-content item-link'><div class='item-media'><i class='material-icons color-teal'>shopping_basket</i></div><div class='item-inner'><div class='item-title' style='color: tomato;'>"+a+"</div><div class='item-after' style='color: tomato;'>"+o+"*"+parseFloat(i).toFixed(2)+"</div></div></div></li>"):$$(".order-item-ul").prepend("<li item-list-receipt='same-same' ><div class='item-content item-link'><div class='item-media'><i class='material-icons color-teal'>shopping_basket</i></div><div class='item-inner'><div class='item-title'>"+a+"</div><div class='item-after'>"+o+"*"+parseFloat(i).toFixed(2)+"</div></div></div></li>")})},500*l)}(l)}),$$(document).on("click",".update-quantity",function(e){deviceReady.returnSocket();var t=this.id,i=$$(this).attr("price"),a=$$(this).attr("last-total"),o=$$(this).attr("itemName"),s=$$(this).attr("itemBuying"),r=$$(this).attr("itemWeight"),n=$$(this).attr("itemIcon"),c=$$(this);myApp.prompt("How many of this item do you want?","ENTER QUANTITY",function(e){if(""!=e){if(/^[0-9-+]+$/.test(e)){totalCost-=parseFloat(a),totalBuying-=parseFloat(s),totalWeight-=parseFloat(r);var l=e*parseFloat(i),d=e*parseFloat(s),p=e*parseFloat(r);totalCost+=l,totalBuying+=d,totalWeight+=p,c.attr("last-total",l).attr("itemBuying",d).attr("itemWeight",p),$("[title"+t+"]").attr("title"+t,l).attr("itemBuying",d).attr("itemWeight",p),$$(".total-cost-div").text(currencyCode+" "+totalCost.toFixed(2)),$$("#quantity-div"+t).html(e+" * "+currencyCode+" "+i+" = "+currencyCode+" "+l),removeItemObj(itemListArray,t),itemListArray.push({id:t,price:i,totalPrice:l,quantity:e,itemName:o,itemIcon:encodeURIComponent(n)})}else showToast("Enter number please!")}})}),$$(document).on("click",".remove-item",function(e){if(totalCost>0){deviceReady.returnSocket();var t=this.id,i=$$(this).attr("title"+t),a=$$(this).attr("itemBuying"),o=$$(this).attr("itemWeight"),s=($$(this).attr("itemIcon"),totalCost-parseFloat(i)),r=totalBuying-parseFloat(a),n=totalWeight-parseFloat(o);removeItemObj(itemListArray,t),totalCost=s,totalBuying=r,totalWeight=n,$$(".total-cost-div").text(currencyCode+" "+totalCost.toFixed(2)),$("[id='item-id"+t+"']").remove()}$$("[uniqueR='"+t+"']").html("<i class='material-icons' style='margin-top:5px;color:green;'>add_shopping_cart</i>").removeClass("remove-item").addClass("show-non-barcode-items-ul-link")}),$$(document).on("click",".shop-reg-btn",function(e){var t=deviceReady.returnSocket(),i=$$(".shop-name-input").val(),a=$$(".admin-name-input").val(),o=$$(".shop-address-input").val(),s=$$(".admin-phone-input").val(),r=$$(".shop-email-input").val(),n=$$(".shop-des-input").val(),c=$$(".shop-category-input").val(),l=$$(".shop-password-input").val(),d=$$(".shop-verify-input").val(),p="+"+$$(".select-country-code-input").val(),m="SI"+Math.floor(899999*Math.random()+1e5),u="RI"+Math.floor(89999*Math.random()+1e4),v=Date.now();myApp.actions([[{text:"<span style='border-bottom: 1px solid #ccc;'>By Clicking I Agree button, you are confirming that you will abide by our terms and condition. Click READ button for more else cancel</span>",label:!0},{text:"<span style='font-size:12px; font-weight:bold;'>I AGREE</span>",onClick:function(){""!=i&&""!=o&&""!=r&&""!=l&&""!=a&&""!=n&&""!=s?l.length>5?l==d?myApp.confirm("Did you provide the correct details about your store?","CONFIRM DETAILS",function(e){t.emit("register-shop",m,i,o,r,c,l,a,u,n,s,p,v,function(e,t){myApp.hidePreloader(),processing=!1,200==e?(shopLogged=m,currentShopId=m,currentShopName=i,shopDescription=n,stopProcess(),$$(".shopNameShow").text(i.toUpperCase()),mainView.router.load({pageName:"shop-main-page"}),currencyCode=t,window.localStorage.setItem("currencyCode",t),loggedIn=!0,window.localStorage.setItem("shop-id",m),window.localStorage.setItem("shop-name",i),window.localStorage.setItem("shopDescription",shopDescription),window.localStorage.setItem("shopAddress",o),window.localStorage.setItem("shopPassword",l),window.localStorage.setItem("positionLogged","ADMIN"),window.localStorage.setItem("loggedUserId",u),$$(".store-link-after").text("https://smartstoreweb.net/dashboard/#!/#"+currentShopId),loggedUserId=u,positionLogged="ADMIN",myApp.alert("Your shop ID is "+m+" and your password is "+l+". Please keep these credentials safe for they will be required on your next log in","Hi, "+a)):showToast("There was an error in your registration, try using another email address!")}),processStatus(1e4)}):showToast("password fields do not match!"):showToast("password should be at least 6 characters long!"):showToast("Please fill all the fields!")}},{text:"<span style='font-size:12px; font-weight:bold;'>READ</span>",onClick:function(){$$(".tnc-btn").click()}}]])}),$$(document).on("click",".shop-login-btn",function(e){var t=deviceReady.returnSocket();myApp.modalLogin("","LOGIN BELOW TO ACCESS YOUR PANEL",function(e,i){""!=e&&""!=i&&(t.emit("login",e,i,function(e){if(e.length>0){var a=e[0].position,o=e[0].userId,s=e[0].shopId;window.localStorage.setItem("positionLogged",a),window.localStorage.setItem("loggedUserId",o),loggedUserId=o,positionLogged=a,t.emit("setShopDetails",s,function(e){if(e.length>0){var t=e[0].shopName,o=(e[0].shopMerchant,e[0].shopAddress),r=e[0].activationDate,n=e[0].months,c=e[0].package,l=e[0].shopDes,d=e[0].currencyCode;shopDescription=l,shopLogged=s,currentShopId=s,currentShopName=t,userLogged="shop",stopProcess(),$$(".shopNameShow").text(t.toUpperCase()),loggedIn=!0,currencyCode=d,window.localStorage.setItem("currencyCode",currencyCode),window.localStorage.setItem("shop-id",s),window.localStorage.setItem("shopDes",l),window.localStorage.setItem("shop-name",t),window.localStorage.setItem("shopAddress",o),window.localStorage.setItem("shopPassword",i),checkActiveStatus(r,n,c),"WAITER/WAITRESS/DELIVERER"==a?(mainView.router.load({pageName:"deliverer-main-page"}),getOrdersToDeliver()):mainView.router.load({pageName:"shop-main-page"}),getActivationDate(),getOrders("getOrdersShop"),getReportsFn()}})}else myApp.alert("Incorrect login credentials","LOGIN FAILED")}),processStatus(1e4))})}),$$(document).on("click",".subscribe-btn",function(e){0==accountActive?accountIsSuspended():myApp.confirm("Your account is still in "+packageSubscribed+" mode, Click proceed to upgrade or downgrade",packageSubscribed+" ACCOUNT",function(e){mainView.router.load({pageName:"select-package-page"})}),getExtraCharges()}),$$(document).on("click",".subscribe-now-btn",function(e){var t=$$(this).attr("total"),i=(parseFloat($$(this).attr("total"))+parseFloat(extraCharges)).toFixed(2),a=$$(this).attr("month"),o=$$(this).attr("package"),s=Date.now();myApp.confirm("You have selected "+o+" package for "+a+" months, You will be redirected to paypal for secure payment. The additional service fee amount is the service fee you received from your customers. The total amount to be paid is $ "+i,"TOTAL $"+parseFloat(t).toFixed(2)+" + $"+parseFloat(extraCharges).toFixed(2)+" SERVICE FEES",function(e){window.location=serverUrl+"companySubscribe/"+currentShopId+"/activationTime/"+s+"/amount/"+i+"/package/"+o+"/month/"+a+"/platform/web"})}),$$(document).on("change",".select-package-input",function(e){var t=$$(this).val();if("BASIC"==t){$$(".package-details-ul").html("<li><div class='item-content'><div class='item-media'><i class='material-icons color-green'>done</i></i></div><div class='item-inner'><div class='item-title'>7 DAYS FREE</div></div></div></li><li><div class='item-content'><div class='item-media'><i class='material-icons color-green'>done</i></i></div><div class='item-inner'><div class='item-title'>24/7 SUPPORT</div></div></div></li><li><div class='item-content'><div class='item-media'><i class='material-icons color-green'>done</i></i></div><div class='item-inner'><div class='item-title'>SMART ORDER</div></div></div></li><li><div class='item-content'><div class='item-media'><i class='material-icons' style='color:tomato;'>cancel</i></i></div><div class='item-inner'><div class='item-title'>POINT OF SALE</div></div></div></li><li><div class='item-content'><div class='item-media'><i class='material-icons' style='color:tomato;'>cancel</i></i></div><div class='item-inner'><div class='item-title'>SALES REPORTS</div></div></div></li><li><div class='item-content'><div class='item-media'><i class='material-icons' style='color:tomato;'>cancel</i></i></div><div class='item-inner'><div class='item-title'>SELF-CHECKOUT</div></div></div></li><li><a href='#' class='item-link smart-select'><select class='subscriptionMonths option-goBack' style='color:#757575;'><option value='1'>1</option><option value='2'>2</option><option value='3'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='11'>11</option><option value='12'>12</option></select><div class='item-content'><div class='item-media'><i class='icon material-icons color-teal'>today</i></div><div class='item-inner'><div class='item-title'>HOW MANY MONTHS?</div></div></div></a></li>");var i=4}else if("ADVANCED"==t){$$(".package-details-ul").html("<li><div class='item-content'><div class='item-media'><i class='material-icons color-green'>done</i></i></div><div class='item-inner'><div class='item-title'>7 DAYS FREE</div></div></div></li><li><div class='item-content'><div class='item-media'><i class='material-icons color-green'>done</i></i></div><div class='item-inner'><div class='item-title'>24/7 SUPPORT</div></div></div></li><li><div class='item-content'><div class='item-media'><i class='material-icons color-green'>done</i></i></div><div class='item-inner'><div class='item-title'>SMART ORDER</div></div></div></li><li><div class='item-content'><div class='item-media'><i class='material-icons color-green'>done</i></i></div><div class='item-inner'><div class='item-title'>POINT OF SALE</div></div></div></li><li><div class='item-content'><div class='item-media'><i class='material-icons color-green'>done</i></i></div><div class='item-inner'><div class='item-title'>SALES REPORTS</div></div></div></li><li><div class='item-content'><div class='item-media'><i class='material-icons' style='color:tomato;'>cancel</i></i></div><div class='item-inner'><div class='item-title'>SELF-CHECKOUT</div></div></div></li><li><a href='#' class='item-link smart-select'><select class='subscriptionMonths option-goBack' style='color:#757575;'><option value='1'>1</option><option value='2'>2</option><option value='3'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='11'>11</option><option value='12'>12</option></select><div class='item-content'><div class='item-media'><i class='icon material-icons color-teal'>today</i></div><div class='item-inner'><div class='item-title'>HOW MANY MONTHS?</div></div></div></a></li>");i=7}else if("COMMUNITY"==t){$$(".package-details-ul").html("<li><div class='item-content'><div class='item-media'><i class='material-icons color-green'>done</i></i></div><div class='item-inner'><div class='item-title'>7 DAYS FREE</div></div></div></li><li><div class='item-content'><div class='item-media'><i class='material-icons color-green'>done</i></i></div><div class='item-inner'><div class='item-title'>24/7 SUPPORT</div></div></div></li><li><div class='item-content'><div class='item-media'><i class='material-icons color-green'>done</i></i></div><div class='item-inner'><div class='item-title'>SMART ORDER</div></div></div></li><li><div class='item-content'><div class='item-media'><i class='material-icons color-green'>done</i></i></div><div class='item-inner'><div class='item-title'>POINT OF SALE</div></div></div></li><li><div class='item-content'><div class='item-media'><i class='material-icons color-green'>done</i></i></div><div class='item-inner'><div class='item-title'>SALES REPORTS</div></div></div></li><li><div class='item-content'><div class='item-media'><i class='material-icons color-green'>done</i></i></div><div class='item-inner'><div class='item-title'>SELF-CHECKOUT</div></div></div></li><li><a href='#' class='item-link smart-select'><select class='subscriptionMonths option-goBack' style='color:#757575;'><option value='1'>1</option><option value='2'>2</option><option value='3'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='11'>11</option><option value='12'>12</option></select><div class='item-content'><div class='item-media'><i class='icon material-icons color-teal'>today</i></div><div class='item-inner'><div class='item-title'>HOW MANY MONTHS?</div></div></div></a></li>");i=50}$$(".subscribe-now-btn,.subscriptionMonths").attr("total",i).attr("month",1).attr("package",t),$$(".show-total-sub-div").text("$"+i.toFixed(2))}),$$(document).on("change",".subscriptionMonths",function(e){var t=$$(this).attr("total"),i=$$(this).val(),a=parseFloat(t)*parseFloat(i);$$(".show-total-sub-div").text("$"+a.toFixed(2)),$$(".subscribe-now-btn").attr("total",a).attr("month",i)}),$$(document).on("click",".proceed-add-item-btn",function(e){var t=$$(".item-name-input").val(),i=$$(".item-desc-input").val(),a=$$(".item-buying-input").val(),o=$$(".item-selling-input").val(),s=$$(".item-quantity-input").val(),r=$$(".item-weight-input").val(),n=$$(".item-barcode-input").val(),c=$$(".select-capture-category-input").val(),l=$$(".select-capture-sr-input").val(),d=$$(".expiryDate-input").val(),p=Date.now(),m="files/items/"+t+p+".png",u=$(".hiddenFileInputAvatar").prop("files")[0];""!=t&&""!=o&&""!=n&&""!=r?""==u?(addItemFn(t,i,a,o,n,s,shopLogged,r,m,c,l,d),processStatus(1e4)):(ajaxUpload(u,m,function(e){"success"==e&&addItemFn(t,i,a,o,n,s,shopLogged,r,m,c,l,d)}),processStatus(6e4)):showToast("Please fill in correctly!")}),$$(document).on("click",".create-account-btn",function(e){var t=deviceReady.returnSocket(),i=$$(".practitioner-name").val(),a=$$(".organization-account-name").val(),o=$$(".organization-admin-name").val(),s=$$(".user-id").val(),r=$$(".reference-number").val(),n=$$(".password-input").val(),c=$$(".organization-website").val(),l=$$(".email-address").val(),d=$$(".phone-number").val(),p=$$(".physical-address-input").val(),m=$$(".specialization-select").val(),u=$$(".hospital-clinic-type-select").val(),v=$$(".emergency-type-select").val(),h=$$(".countryList").val(),g=$$(".city-input").val();if("PRACTITIONERS"==currentUser){var y=i;s=s,o=i}else{y=a;o=o,s=""}if("HOSPITALS AND CLINICS"==currentUser)var f=u;else if("EMERGENCY SERVICES"==currentUser)f=v;else if("PRACTITIONERS"==currentUser)f=m;else f="NO SUBCATEGORY";""!=y&&""!=p&&""!=o&&""!=n&&""!=l&&""!=d&&""!=r&&""!=g?n.length>5?myApp.confirm("Have you entered your inputs correctly?","CONFIRM INPUTS",function(){getLocation(function(e,i){var a=new FormData,m=$(".hiddenFileInputAvatar").prop("files")[0],u=$(".hiddenFileInput").prop("files")[0],v=$$(".hiddenFileInput").val(),w=$$(".hiddenFileInputAvatar").val(),S=Date.now()+"."+v.slice(-3),b=Date.now()+"."+w.slice(-3);a.append("avatar",m),a.append("avatarName",b),a.append("adminName",o),a.append("supportingDocName",S),a.append("supportingDoc",u),a.append("accountName",y),a.append("physicalAddress",p),a.append("password",n),a.append("idNo",s),a.append("emailAddress",l),a.append("phoneNo",d),a.append("referenceNumber",r),a.append("website",c),a.append("mainCategory",currentUser),a.append("subCategory",f),a.append("latitude",e),a.append("longitude",i),a.append("country",h),a.append("city",g),$.ajax({url:serverUrl+"uploadFile",type:"POST",data:a,processData:!1,contentType:!1,success:function(e){stopProcess(),myApp.alert(e),$$(".staff-inputs input").val(""),loginFn(l,n,t)}})}),processStatus(6e4,"Creating account, please wait...")}):myApp.alert("Password length should be at least 6 characters!"):myApp.alert("Please fill in all fields!")}),$$(document).on("click",".proceed-edit-item-btn",function(e){var t=deviceReady.returnSocket(),i=$$(".edit-item-name-input").val(),a=$$(".edit-item-desc-input").val(),o=$$(".edit-item-buying-input").val(),s=$$(".edit-item-selling-input").val(),r=$$(".edit-item-quantity-input").val(),n=$$(this).attr("id");""!=i&&""!=s?(t.emit("update-item",i,a,o,s,r,currentShopId,n,function(e){200==e?myApp.alert("item was successfully updated!","SUCCESS"):myApp.alert("There was an error while trying to update an item!","FAILED"),stopProcess(),window.history.back(2),$$(".manage-item-review").html("")}),processStatus(1e4)):myApp.alert("Please fill in correctly!")}),$$(document).on("click",".view-reports-btn",function(e){getReportsFn()}),$$(document).on("click",".get-most-purchased-btn",function(e){1==accountActive?(mainView.router.load({pageName:"most-purchased-page"}),deviceReady.returnSocket().emit("get-most-purchased",currentShopId),processStatus(1e4)):accountIsSuspended()}),$$(document).on("click",".add-damage-expense-btn",function(e){"expenses"==$$(this).attr("title")?mainView.router.load({pageName:"add-expenses-page"}):mainView.router.load({pageName:"item-manage-option-page"})}),$$(document).on("change",".sales-year-select,.sales-month-select",function(e){var t=$$(".sales-year-select").val()+"-"+$$(".sales-month-select").val();$$(".sales-report-order-ul li").hide(),$$("[purchaseMonth='"+t+"']").show()}),$$(document).on("click",".view-total-sales-btn",function(e){1==accountActive?mainView.router.load({pageName:"total-sales-page"}):accountIsSuspended()}),$$(document).on("click",".save-expense-btn",function(e){var t=deviceReady.returnSocket(),i=$$(".expense-name-input").val(),a=$$(".expense-quantity-input").val(),o=$$(".expense-amount-input").val();""!=i&&""!=a&&""!=o?(o=parseFloat(o)*parseFloat(a),myApp.confirm("Add "+i+" to your expense with a total amount of "+o.toFixed(2),"CONFIRM EXPENSE",function(e){t.emit("addExpense",currentShopId,i,a,o,function(e){stopProcess(),e&&($(".view-reports-btn").click(),window.history.back(2),showToast("You have successfully added a new expense"))}),processStatus(1e4)})):showToast("Please fill out all fields!")}),$$(document).on("click",".sales-report-order-ul li",function(e){mainView.router.load({pageName:"daily-sales-page"});var t=$$(this).attr("purchaseDay");$$(".daily-sales-ul").html(""),$(".daily-total-price,.daily-profit-div,.show-total-weight-sec").text(0);for(var i=0,a=0;a<customObj.length;a++){var o=customObj[a].id,s=customObj[a].amount,r=customObj[a].initAmount,n=customObj[a].totalWeight,c=customObj[a].purchaseDay,l=customObj[a].itemListString;if(t==c){$$(".daily-sales-ul").prepend("<li totalWeight='"+n+"' itemListString='"+l+"' order-sales-report='"+o+"' totalPrice='"+s+"' initAmount='"+r+"'><div class='item-content item-link'><div class='item-media'><i class='material-icons color-teal'>check_circle</i></div><div class='item-inner'><div class='item-title'>ORDER "+o+"</div><div class='item-after'>"+parseFloat(s).toFixed(2)+"</div></div></div></li>");var d=parseFloat($(".daily-total-price").text())+parseFloat(s);$(".daily-total-price").text(d.toFixed(2));var p=parseInt($(".show-total-weight-sec").text())+parseInt(n),m=(parseFloat(p)/1e3).toFixed(3);$$(".show-total-weight-sec").html(m+" KG"),parseFloat(s),i+=parseFloat(s)-parseFloat(r),$(".daily-profit-div").text(parseFloat(i).toFixed(2))}}}),$$(document).on("click",".daily-sales-ul li",function(e){var t=$$(this).attr("itemListString"),i=$$(this).attr("order-sales-report"),a=$$(this).attr("totalPrice"),o=$$(this).attr("initAmount"),s=$$(this).attr("totalWeight");mainView.router.load({pageName:"order-details-page"}),$$(".customer-sales-show-div").hide(),$$(".shop-sales-show-div").show(),$$(".order-item-ul").html(""),$(".order-total-price,.order-profit-div,.show-order-total-weight-sec").text(0),$$(".order-number-div").text("ORDER #"+i+" DETAILS"),$$(".order-total-price").html(parseFloat(a).toFixed(2));var r=(parseFloat(s)/1e3).toFixed(3);$$(".show-order-total-weight-sec").html(r+" KG");var n=JSON.parse(t),c=parseFloat(a)-parseFloat(o);$$(".order-profit-div").html(c.toFixed(2));for(var l=0;l<n.length;l++){var d=n[l].price,p=n[l].itemName,m=n[l].quantity;$$(".order-item-ul").prepend("<li><div class='item-content item-link'><div class='item-media'><i class='material-icons color-teal'>shopping_basket</i></div><div class='item-inner'><div class='item-title'>"+p+"</div><div class='item-after'>"+m+"*"+currencyCode+d+"</div></div></div></li>")}}),$$(document).on("click",".remove-item-btn",function(e){var t=deviceReady.returnSocket(),i=this.id;myApp.confirm("This item will be removed from your store?","CONFIRM REMOVAL",function(e){t.emit("remove-item",i,function(e){200==e&&myApp.alert("Item removal was success","SUCCESS"),stopProcess()}),processStatus(1e4)})}),$$(document).on("click",".view-users-btn",function(e){1==accountActive?(getShopUsers(),mainView.router.load({pageName:"all-user-page"}),processStatus(1e4)):accountIsSuspended()}),$$(document).on("click",".proceed-add-user-btn",function(e){var t=deviceReady.returnSocket();if("ADMIN"==positionLogged){var i=$$(".user-name-input").val(),a=$$(".user-email-input").val(),o=$$(".user-phone-input").val(),s=$$(".user-position-select").val(),r="RI"+Math.floor(89999*Math.random()+1e4);""!=i&&"SELECT POSITION"!=s&&""!=a&&""!=o?myApp.confirm("Add "+i+" as "+s+" ?","CONFIRM",function(e){t.emit("shop-add-user",i,s,r,currentShopId,a,"123456",o,function(e){200==e&&(getShopUsers(),myApp.alert(i+" has been added as "+s,"SUCCESS"),window.history.back())}),processStatus(1e4)}):showToast("Please fill in correctly")}else myApp.alert("You are not authorized to perform this task!","PERMISSION DENIED")}),$$(document).on("click",".get-order-no-btn",function(e){var t=deviceReady.returnSocket();1==accountActive?"ADMIN"==positionLogged||"SECURITY OFFICER"==positionLogged?($$(".order-verify-ul").html(""),myApp.prompt("Get this from the customer","ENTER ORDER NUMBER",function(e){""!=e&&(t.emit("get-order-number",e,function(i,a,o,s){if(200==i){var r=JSON.parse(a);mainView.router.load({pageName:"verify-order-page"}),$$(".verify-order-show").text("ORDER #"+e),$$(".total-cost-div-v").text(currencyCode+" "+parseFloat(o).toFixed(2)),$$(".verify-order-btn").attr("id",e);for(var n=(parseFloat(s)/1e3).toFixed(3),c=0;c<r.length;c++)!function(e){setTimeout(function(){var i=r[e].price,a=r[e].itemName,o=r[e].quantity,s=r[e].id;t.emit("getItemOfSameMass",currentShopId,s,function(e){1==e?$$(".order-verify-ul").prepend("<li><div class='item-content'><div class='item-media'><i class='material-icons'>blur_on</i></div><div class='item-inner'><div class='item-title' style='color: tomato;'>"+a+"</div><div class='item-after' style='color: tomato;'>"+o+" * "+currencyCode+" "+i+"</div></div></div></li>"):$$(".order-verify-ul").prepend("<li><div class='item-content'><div class='item-media'><i class='material-icons'>blur_on</i></div><div class='item-inner'><div class='item-title'>"+a+"</div><div class='item-after'>"+o+" * "+currencyCode+" "+i+"</div></div></div></li>")})},500*c)}(c);$$(".show-total-weight-sec").html("<center><a href='#' class='button' style='width: 200px; margin-top: 10px; color:#757575;'>"+n+"Kg</a></center>")}else myApp.alert(a,"ORDER NO ERROR!");stopProcess()}),processStatus(1e4))})):myApp.alert("You are not authorized to perform this task!","PERMISSION DENIED"):accountIsSuspended()}),$$(document).on("click",".verify-order-btn",function(e){var t=deviceReady.returnSocket(),i=this.id;myApp.confirm("Your user ID will be added to verified by","CONFIRM ORDER #"+i,function(e){t.emit("verify-order",i,loggedUserId,function(e){200==e?myApp.alert("Verification was success","VERIFICATION SUCCESS"):myApp.alert("Verification failed","VERIFICATION ERROR"),stopProcess()}),processStatus(1e4)})}),$$(document).on("click",".add-item-btn",function(e){1==accountActive?myApp.actions([[{text:"<span style='border-bottom: 1px solid #ccc;'>HOW WOULD YOU LIKE TO ADD ITEMS?</span>",label:!0},{text:"<span style='font-size:12px; font-weight:bold;'>ADD NEW</span>",onClick:function(){checkItemType("add")}},{text:"<span style='font-size:12px; font-weight:bold;'>DUPLICATE</span>",onClick:function(){duplicateItems()}}]]):accountIsSuspended()}),$$(document).on("click",".scan-item-btn",function(e){if(null!=shopLogged)var t=shopLogged;else t=currentShopId;1==accountActive?"BASIC"!=packageSubscribed?checkLogStatus(t,"POS","BARCODE"):showToast("UPGRADE TO ADVANCED TO CONTINUE"):accountIsSuspended()}),$$(document).on("click",".pick-item-btn",function(e){getInitialData()}),$$(document).on("click",".manage-item-btn",function(e){1==accountActive?(getBarcodeItems(currentShopId,"MANAGE","NO BARCODE","NO BARCODE"),mainView.router.load({pageName:"shelf"})):accountIsSuspended()}),$$(document).on("click",".manage-items-page-btn",function(e){mainView.router.load({pageName:"item-manage-option-page"})}),$$(document).on("change",".get-shops-by-category-select",function(e){var t=deviceReady.returnSocket(),i=$$(this).val();$$(".shops-to-dup-ul").html(""),t.emit("getItemsToDuplicateByCategory",i,function(e){stopProcess(),displayToDuplicate(e)}),processStatus(1e4)}),$$(document).on("click",".shops-to-dup-ul li",function(e){var t=$$(this).attr("shopId"),i=$$(this).attr("shopName");myApp.confirm("Duplicate items from "+i+"?. If you have once duplicated from this store, please find other stores since this will cause multiple duplication of the same item","CONFIRM",function(e){nowDuplicate(t,i)})}),$$(document).on("change",".get-items-by-category-input",function(e){displayItemsByCategory($$(this).val())}),$$(document).on("click",".view-item-details-btn",function(e){var t=$$(this).attr("id"),i=$$(this).attr("itemName"),a=$$(this).attr("itemDesc"),o=$$(this).attr("itemSelling"),s=$$(this).attr("itemQuantity"),r=$$(this).attr("itemBuying"),n=$$(this).attr("itemWeight"),c=$$(this).attr("action"),l=$$(this).attr("itemIcon"),d=$$(this).attr("buyHowMany"),p=$$(this).attr("getHowMany"),m=$$(this).attr("dueDate"),u=$$(this).attr("discount"),v=$$(this).attr("special"),h=$$(this).attr("expiryDate");if(""!=v){var g=isItemSpecial(t,v,u,d,p,m,o).split("::");if("DISCOUNT"==v){o=g[0];var $="<span style='color:orange;' class='special-info-btn' title='You have "+u+"% off until "+m+"'>-"+u+"%</span>"}else{o=o;$="<i class='material-icons color-orange special-info-btn' title='Buy "+d+" and get "+p+" for free until "+m+"'>grade</i>"}}else $="";if("POS"==c){var y="<i class='material-icons color-green' style='margin-top:5px;'>add_shopping_cart</i>";$=$}else if("MANAGE"==c){y="<i class='material-icons color-purple' style='margin-top:5px;'>edit</i>";$=""}if(""==l)var f="<i class='material-icons color-teal' style='font-size:80px;'>spa</i>";else f="<img src='"+serverUrl+l+"' style='max-width:100%;' class='itemIcon1'>";mainView.router.load({pageName:"item-details-page"}),$$(".item-desc-div").text(a),$$(".item-weight-div").text(n),$$(".item-quantity-div").text(s),$$(".item-expiryDate-div").text(h),$$(".more-details-div").html("<div class='card' style='border-radius:10px;box-shadow:none;border: 1px solid #ccc;'><div class='card-header' style='text-transform: uppercase;color: #757575;font-size: 10px;font-weight: bold;'>"+$+" "+i.toUpperCase()+"</div><div class='card-content card-content-img2'><center>"+f+"</center></div><div class='card-footer' style='font-weight:bold; font-size:12px;'><a href='#' class='link' style='font-size:10px;font-weight:bold;color:#757575;'>"+parseFloat(o).toFixed(2)+"</a><a href='#' class='link show-non-barcode-items-ul-link' action='"+c+"' id='"+t+"' itemName='"+i+"' itemDesc='"+a+"' itemSelling='"+o+"' itemQuantity='"+s+"' itemBuying='"+r+"' itemWeight='"+n+"' itemIcon='"+l+"' uniqueR='"+t+"' title"+t+"="+o+" special='"+v+"' buyHowMany='"+d+"' getHowMany='"+p+"' discount='"+u+"' dueDate='"+m+"'>"+y+"</a></div></div>")}),$$(document).on("click",".edit-item-btn",function(e){var t=$$(".edit-item-name-input").val(),i=$$(".edit-item-selling-input").val(),a=$$(this).attr("id");myApp.actions([[{text:"UPDATE ITEM INFO",onClick:function(){mainView.router.load({pageName:"edit-item-page"})}},{text:"ADD ITEM TO DAMAGED GOODS",onClick:function(){addItemToDamaged(a,t,i)}},{text:"ADD TO SPECIALS",onClick:function(){addToSpecial(a,t,i)}},{text:"REMOVE FROM SPECIALS",onClick:function(){removeFromSpecial(a,t,i)}}]])}),$$(document).on("click",".special-info-btn",function(e){showToast($(this).attr("title"))}),$$(document).on("change",".special-select",function(e){"DISCOUNT"==$$(this).val()?($$(".discount-li").show(),$$(".buyGet").hide()):($$(".discount-li").hide(),$$(".buyGet").show())}),$$(document).on("click",".save-special-btn",function(e){var t=$$(".special-select").val(),i=$$(".special-discount-input").val(),a=$$(".buy-how-many-input").val(),o=$$(".get-how-many-input").val(),s=$$(".special-due-input").val(),r=deviceReady.returnSocket(),n=this.id,c=$$(this).attr("itemName");if("DISCOUNT"==t)if(""!=i)var l=!0;else l=!1;else if(""!=a&&""!=o)l=!0;else l=!1;l?myApp.confirm("Are you sure you want to add "+c+" to the selected special?","CONFIRM SPECIAL",function(e){getGPS(function(e,l){r.emit("addToSpecial",t,i,a,o,s,n,currentShopName,currentShopId,e,l,function(e){stopProcess(),showToast(e?"You have successfully added "+c+" to "+t+" special!":"Could not add this item to special!")})}),processStatus(1e4)}):showToast("Please fill out all fields to proceed!")}),$$(document).on("click",".show-non-barcode-items-ul-link",function(e){var t=$$(this).attr("id"),i=$$(this).attr("itemName"),a=$$(this).attr("itemDesc"),o=$$(this).attr("itemSelling"),s=$$(this).attr("itemQuantity"),r=$$(this).attr("itemBuying"),n=$$(this).attr("itemWeight"),c=$$(this).attr("action"),l=$$(this).attr("itemIcon"),d=$$(this).attr("buyHowMany"),p=$$(this).attr("getHowMany"),m=$$(this).attr("dueDate"),u=$$(this).attr("discount"),v=$$(this).attr("special");"POS"==c?(displayItemsOnCart(t,i,a,o,s,r,n,l,v,u,d,p,m,!0),$$("[uniqueR='"+t+"']").html("<i class='material-icons' style='margin-top:5px;color:tomato;'>cancel</i>").addClass("remove-item").removeClass("show-non-barcode-items-ul-link")):"MANAGE"==c&&displayToManage(t,i,a,o,s,r,n)}),$$(document).on("click",".shop-edit-btn",function(e){var t=$$(".shop-description-input-edit").val(),i=$$(".shop-name-input-edit").val(),a=$$(".shop-address-input-edit").val(),o=$$(".shop-password-input-edit").val(),s=$$(".shop-verify-input-edit").val(),r=$$(".operational-radius-input").val();""!=i&&""!=a&&""!=o?o.length>5?o==s?updateStore(t,a,i,o,currentShopId,r):showToast("Your password fields do not match!"):showToast("Your password field should be at least 6 characters long!"):showToast("Please fill in all the required fields!")}),$$(document).on("click",".search-item-btn",function(e){var t=deviceReady.returnSocket(),i=$$(".search-radius-input").val(),a=$$(".search-item-input").val();$$(".item-search-found").html(""),mainView.router.load({pageName:"item-search-res-page"}),getGPS(function(e,o){t.emit("search-item",e,o,i,a)}),processStatus(15e3)}),$$(document).on("click",".smart-order-log-btn",function(e){myApp.confirm("Select below to access menu portal","LOGIN AS ?",function(e){null!=phoneNo?customerLogin():changeNumber()},function(){staffLogin()})}),$$(document).on("change",".get-smart-res-random",function(e){var t=deviceReady.returnSocket();$$(".display-items-ul").html("");var i=$$(this).val();t.emit("getSmartRestaurantItemsByCategory",i,currentShopId,function(e){if(e.length>0)for(var t=0;t<e.length;t++){var i=e[t].id,a=e[t].itemIcon,o=e[t].itemName,s=e[t].itemSelling,r=(e[t].itemQuantity,e[t].itemDesc,e[t].itemBuying),n=e[t].itemWeight,c=getQuantity(i);if(""!=a)var l=serverUrl+a;else l="https://image.iol.co.za/image/1/process/620x349?source=https://cdn.africannewsagency.com/public/ana/media/media/2018/06/20/media-reference%3Aac7696ea3d3c4c2993efe0dfff55520a.jpg&operation=CROP&offset=0x278&resize=5315x2984";$$(".display-items-ul").prepend("<div class='card' all-list-card='"+i+"' style='border-radius:20px;box-shadow:none;'>   <div class='card-header' style='font-size:11px;color:#757575;font-weight:bold;'>"+o.toUpperCase()+" ("+currencyCode+s+")</div>  <div class='card-content card-content-img' id='"+i+"' itemPrice='"+s+"'><center><img src='"+l+"' class='itemIcon'></center></div><div class='card-footer' style='font-size:15px; font-weight:bold;'><a href='#' class='link' itemCostText='id"+i+"' quantity='"+c+"' style='font-size:9px;'>"+s+"("+c+") = "+parseFloat(c)*parseFloat(s)+"</a><a href='#' class='link subtract-item-btn' itemIcon='"+a+"' itemBuying='"+r+"' itemWeight='"+n+"' id='"+i+"' itemPrice='"+s+"' quantity='"+c+"' itemCost='id"+i+"' itemName='"+o+"'><i class='material-icons' style='margin-top: 7px; color:#757575;'>exposure_neg_1</i></a><a href='#' class='link add-more-item-btn' itemIcon='"+a+"' itemBuying='"+r+"' itemWeight='"+n+"' id='"+i+"' itemPrice='"+s+"' quantity='"+c+"' itemCost='id"+i+"' itemName='"+o+"'><i class='material-icons' style='margin-top: 7px; color:#757575;'>exposure_plus_1</i></a><a href='#' class='link remove-smart-item-btn' itemBuying='"+r+"' itemWeight='"+n+"' itemPrice='"+s+"' id='"+i+"' quantity='"+c+"' itemCost='id"+i+"'><i class='material-icons' style='margin-top: 7px; color:tomato;'>cancel</i></a></div> </div>")}})}),$$(document).on("click",".add-more-item-btn",function(e){var t=$$(this).attr("id"),i=$$(this).attr("itemName"),a=parseFloat($$(this).attr("itemPrice")),o=$$(this).attr("itemBuying"),s=$$(this).attr("itemWeight"),r=$$(this).attr("itemIcon");totalCost+=a,totalBuying+=parseFloat(o),totalWeight+=parseFloat(s),$$(".show-total-amount,.total-cost-div").text(currencyCode+" "+totalCost.toFixed(2));var n=parseFloat($$(this).attr("quantity"));n++,$$("[itemCost='id"+t+"']").attr("quantity",n),$$("[itemCostText='id"+t+"']").html(a+"("+n+") = "+a*n),removeItemObj(itemListArray,t);var c=a*n;itemListArray.push({id:t,price:a,totalPrice:c,quantity:n,itemName:i,itemIcon:encodeURIComponent(r)})}),$$(document).on("click",".subtract-item-btn",function(e){var t=$$(this).attr("id"),i=$$(this).attr("itemName"),a=parseFloat($$(this).attr("itemPrice")),o=parseFloat($$(this).attr("quantity")),s=$$(this).attr("itemBuying"),r=$$(this).attr("itemWeight"),n=$$(this).attr("itemIcon");if($$("[all-order-card='"+t+"']").remove(),removeItemObj(itemListArray,t),totalCost>0&&o>0){totalCost-=a,$$(".show-total-amount,.total-cost-div").text(currencyCode+" "+totalCost.toFixed(2)),o--,totalBuying-=parseFloat(s),totalWeight-=parseFloat(r),$$("[all-order-card='"+t+"']").remove(),$$("[itemCost='id"+t+"']").attr("quantity",o),$$("[itemCostText='id"+t+"']").html(a+"("+o+") = "+a*o);var c=a*o;itemListArray.push({id:t,price:a,totalPrice:c,quantity:o,itemName:i,itemIcon:encodeURIComponent(n)})}}),$$(document).on("click",".remove-smart-item-btn",function(e){var t=$$(this).attr("id"),i=parseFloat($$(this).attr("itemPrice")),a=parseFloat($$(this).attr("quantity"));$$("[all-order-card='"+t+"']").remove(),removeItemObj(itemListArray,t),0!=a?(totalCost-=i*a,$$("[itemCost='id"+t+"']").attr("quantity","0"),$$(".show-total-amount,.total-cost-div").text(currencyCode+" "+totalCost.toFixed(2)),$$("[itemCostText='id"+t+"']").html(i+"(0) = "+i),totalBuying-=parseFloat(itemBuying)*a,totalWeight-=parseFloat(itemWeight)*a):removeItemObj(itemListArray,t)}),$$(document).on("click",".go-to-cart-btn",function(e){if($$(".display-items-cart-ul").html(""),itemListArray.length>0)for(var t=0;t<itemListArray.length;t++){var i=itemListArray[t].id,a=itemListArray[t].quantity,o=getLocalItems(i,viewedItems,"itemIcon");if(""!=o)var s=serverUrl+o;else s="https://image.iol.co.za/image/1/process/620x349?source=https://cdn.africannewsagency.com/public/ana/media/media/2018/06/20/media-reference%3Aac7696ea3d3c4c2993efe0dfff55520a.jpg&operation=CROP&offset=0x278&resize=5315x2984";$$(".display-items-cart-ul").prepend("<div class='card' all-order-card='"+i+"' style='border-radius:20px;box-shadow:none;'>  <div class='card-header' style='font-size:11px;color:#757575;font-weight:bold;'>"+getLocalItems(i,viewedItems,"itemName").toUpperCase()+" ("+currencyCode+" "+getLocalItems(i,viewedItems,"itemPrice")+")</div>  <div class='card-content card-content-img' id='"+i+"' itemPrice='"+getLocalItems(i,viewedItems,"itemPrice")+"'><center><img src='"+s+"' class='itemIcon'></center></div><div class='card-footer' style='font-size:15px; font-weight:bold;'><a href='#' class='link' itemCostText='id"+i+"' quantity='"+a+"' style='font-size:9px;'>"+getLocalItems(i,viewedItems,"itemPrice")+"("+a+") = "+parseFloat(a)*parseFloat(getLocalItems(i,viewedItems,"itemPrice"))+"</a><a href='#' class='link subtract-item-btn' itemIcon='"+o+"' itemBuying='"+getLocalItems(i,viewedItems,"itemBuying")+"' itemWeight='"+getLocalItems(i,viewedItems,"itemWeight")+"' id='"+i+"' itemPrice='"+getLocalItems(i,viewedItems,"itemPrice")+"' itemName='"+getLocalItems(i,viewedItems,"itemName")+"' quantity='"+a+"' itemCost='id"+i+"'><i class='material-icons' style='margin-top: 7px; color:#757575;'>exposure_neg_1</i></a><a href='#' class='link add-more-item-btn' itemIcon='"+o+"' itemBuying='"+getLocalItems(i,viewedItems,"itemBuying")+"' itemWeight='"+getLocalItems(i,viewedItems,"itemWeight")+"' id='"+i+"' itemPrice='"+getLocalItems(i,viewedItems,"itemPrice")+"' quantity='"+a+"' itemCost='id"+i+"' itemName='"+getLocalItems(i,viewedItems,"itemName")+"'><i class='material-icons' style='margin-top: 7px; color:#757575;'>exposure_plus_1</i></a><a href='#' class='link remove-smart-item-btn' itemBuying='"+getLocalItems(i,viewedItems,"itemBuying")+"' itemWeight='"+getLocalItems(i,viewedItems,"itemWeight")+"' itemPrice='"+getLocalItems(i,viewedItems,"itemPrice")+"' id='"+i+"' quantity='"+a+"' itemCost='id"+i+"'><i class='material-icons' style='margin-top: 7px; color:tomato;'>cancel</i></a></div> </div>")}}),$$(document).on("click",".get-all-categories",function(e){deviceReady.returnSocket().emit("getCategories",currentShopId,function(e){if(e.length>0)for(var t=0;t<e.length;t++){var i=e[t].id,a=e[t].category;0==$$("[category='id"+i+"']").length&&$$(".display-categories-ul").append("<li id="+i+" category='id"+i+"' name='"+a+"'><div class='item-content'><div class='item-media'><i class='material-icons color-white'>local_dining</i></div><div class='item-inner'> <div class='item-title color-white'>"+a+"</div><div class='item-after'></div></div></div></li>")}})}),$$(document).on("click",".itemIcon,.itemIcon1",function(e){var t=[];t.push({url:$(this).attr("src"),caption:""}),myApp.photoBrowser({photos:t,theme:"dark"}).open()}),$$(document).on("click",".ask-for-waiter-btn",function(e){var t=deviceReady.returnSocket();myApp.prompt("Enter table number where you want the waiter to come","ENTER TABLE NUMBER",function(e){t.emit("askForWaiter",currentShopId,e,function(e){stopProcess(),myApp.alert("A waiter is on his way. Thank you!","WAITER CALLED")}),processStatus(1e4,"Calling waiter, Please waiter")})}),$$(document).on("click",".pawn-btn",function(e){null!=phoneNo?myApp.actions([[{text:"PAWN",onClick:function(){pawnOrSellFn("PAWN")}},{text:"SELL",onClick:function(){pawnOrSellFn("SELL")}}]]):changeNumber()}),$$(document).on("click",".driver-account-btn",function(e){showToast("Download our mobile app to continue with this!")}),$$(document).on("click",".shop-pawn-item-btn",function(e){null!=phoneNo?myApp.actions([[{text:"PAWN",onClick:function(){shopPawnOrSellFn("PAWN")}},{text:"SELL",onClick:function(){shopPawnOrSellFn("BUY")}}]]):changeNumber()}),$$(document).on("click",".get-customer-care-button",function(e){mainView.router.load({pageName:"customer-care-page"})}),$$(document).on("click",".whatsApp-btn",function(e){var t=$$(this).attr("phoneNo"),i=$$(this).attr("fname");myApp.confirm("Chat with "+i+" on "+t+" via whatsApp?","CONFIRM UPDATE",function(e){window.location="https://api.whatsapp.com/send?phone="+t})}),$$(document).on("click",".check-order-btn",function(e){getOrders("getOrdersShop"),mainView.router.load({pageName:"manage-order-page"})}),$$(document).on("click",".manage-order-btn",function(e){getOrders("getOrdersCustomer"),mainView.router.load({pageName:"manage-order-page"})}),$$(document).on("click",".no-gutter-big-new-driver",function(e){var t=$$(this).attr("shopId"),i=$$(this).attr("latitude"),a=$$(this).attr("longitude"),o=$$(this).attr("delivery_fee"),s=$$(this).attr("buyerNumber"),r=$$(this).attr("id"),n=($$(this).attr("id"),$$(this).attr("workStatus"));"FREE"==n?($$(".b4-accept-option").show(),$$(".order-picked-option,.cancel-this-job-option").hide()):"READY"==n?($$(".b4-accept-option").hide(),$$(".order-picked-option,.cancel-this-job-option").show()):"PICKED"==n&&$$(".order-picked-option,.cancel-this-job-option,.b4-accept-option").hide(),$$(".driver-order-option-ul li a").attr("shopId",t).attr("latitude",i).attr("longitude",a).attr("delivery_fee",o).attr("buyerNumber",s).attr("id",r)}),$$(document).on("click",".driver-order-option-ul li a",function(e){var t=$$(this).attr("shopId"),i=$$(this).attr("latitude"),a=$$(this).attr("longitude"),o=$$(this).attr("delivery_fee"),s=$$(this).attr("buyerNumber"),r=$$(this).attr("id"),n=$$(this).attr("title");"ACCEPT THIS JOB"==n?jobCounter<4?driverAcceptJob(r,o):showToast("You have enough job to do. Quickly complete the ones marked as favorite!"):"PICK UP LOCATION"==n?getShopGeo(t):"DROP UP LOCATION"==n?getDirection(i,a,"DROP LOCATION"):"CONTACT OWNER"==n?window.location="tel:"+s:"MARK AS DELIVERED"==n?markAsDelivered(r,o,s):"ORDER PICKED"==n?changeOrderStatus(r,"PICKED","status","By picking up this order, you agree you will deliver it?",phoneNo):"CANCEL THIS JOB"==n&&cancelThisJob(r)}),$$(document).on("click",".no-gutter-big",function(e){mainView.router.load({pageName:"show-details-order-page"});var t=JSON.parse($$(this).attr("orderObj")),i=(deviceReady.returnSocket(),$$(this).attr("id")),a=$$(this).attr("location"),o=$$(this).attr("status"),s=$$(this).attr("paidFor"),r=$$(this).attr("total"),n=$$(this).attr("deliverer"),c=$$(this).attr("buyerNumber"),l=$$(this).attr("latitude"),d=$$(this).attr("longitude");if($$(".display-order-details-ul").html(""),$$(".waiting-order-div").hide(),$$(".order-card").show(),$$(".now-serving-header").text("ORDER "+i+" FROM "+a),$$(".show-total-amount").text(currencyCode+" "+parseFloat(r).toFixed(2)),"COLLECTED"==o&&"PAID"==s){var p="<i class='material-icons color-teal'>check_circle</i>";$$(".action-btn").html(p).removeClass("open-popover")}else{p="<i class='material-icons color-teal'>menu</i>";$$(".action-btn").html(p).attr("location",a).attr("status",o).attr("paidFor",s).attr("id",i).attr("deliverer",n).addClass("open-popover")}for(var m=0;m<t.length;m++){t[m].id;var u=t[m].quantity,v=t[m].itemName,h=t[m].totalPrice,g=decodeURIComponent(t[m].itemIcon);if(""==g)var $="<i class='material-icons color-teal' style='font-size:80px;'>spa</i>";else $="<img src='"+serverUrl+g+"' style='max-width:100%;' class='itemIcon1'>";$$(".show-contact-number").text(c),$$(".display-order-details-ul").append("<div class='card shop-list-ul-card' style='width: 150px;border-radius:10px;box-shadow:none;border: 1px solid #ccc;'> <div class='card-header' style='color:#757575;font-weight:bold;font-size:10px;'>"+v.toUpperCase()+"</div><div class='card-content card-content-img1'><center>"+$+"</center></div><div class='card-footer' style='font-size:9px;font-weight:bold;'>"+u+" * "+h+" = "+(parseFloat(u)*parseFloat(h)).toFixed(2)+"</div> </div>"),reverseGeoCode(l,d,function(e){$$(".show-contact-address").text(e),$$(".popup-address-li").attr("title",e).attr("latitude",l).attr("longitude",d)})}}),$$(document).on("click",".popup-address-li",function(e){var t=$$(this).attr("title"),i=$$(this).attr("latitude"),a=$$(this).attr("longitude");myApp.confirm(t+". Press OK to view the address on the map","DELIVERY ADDRESS",function(e){window.open("https://www.google.com/maps/search/?api=1&query="+i+","+a,"_blank")})}),$$(document).on("click",".action-btn",function(e){var t=$$(this).attr("id"),i=($$(this).attr("location"),$$(this).attr("status")),a=$$(this).attr("paidFor"),o=$$(this).attr("deliverer");$$(".order-option-ul li a").attr("id",t).attr("status",i).attr("paidFor",a).attr("deliverer",o)}),$$(document).on("click",".order-option-ul li a",function(e){var t=$$(this).attr("id"),i=$$(this).attr("status"),a=$$(this).attr("title"),o=$$(this).attr("paidFor"),s=$$(this).attr("deliverer");"MARK AS READY"==a?"READY"==i?showToast("Ooh!, this order has been marked as ready already!"):updateOrder(t,"READY","status","Order "+t+" will be marked as ready?",s):"MARK AS PAID"==a?"PAID"==o?showToast("Ooh!, this order has been marked as paid already!"):updateOrder(t,"PAID","paidFor","Order "+t+" will be marked as paid?",s):"MARK AS DELIVERED"==a&&("COLLECTED"==i?showToast("Ooh!, this order has been marked as delivered already!"):updateOrder(t,"COLLECTED","status","Order "+t+" will be marked as delivered?",s))}),$$(document).on("click",".nearby-stores-btn",function(e){null!=phoneNo?(mainView.router.load({pageName:"pawnOrSell-nearby-page"}),$$(".hide-on-agents").show(),$$(".local-store-agents").text("LOCAL STORES"),$$(".pawn-sell-nearby-ul").html(""),getLocalStores()):changeNumber()}),$$(document).on("change",".get-shops-by-category-select",function(e){var t=deviceReady.returnSocket(),i=$$(this).val();$$(".pawn-sell-nearby-ul").html(""),getGPS(function(e,a){t.emit("getLocalStoresByCategory",e,a,i,function(e){stopProcess(),displayLocalStores(e)})})}),$$(document).on("click",".go-to-shop-panel-btn",function(e){selfLogin($$(this).attr("shopId"),"normal")}),$$(document).on("click",".store-link-after-button",function(e){var t=$$(".store-link-after").text();myApp.confirm(t+". Press ok to visit your store","SHARE THE LINK BELOW",function(e){window.open(t,"_blank")})}),$$(document).on("click",".store-closed-btn",function(e){myApp.alert($$(this).attr("title"),"OPEN STATUS")}),$$(document).on("click",".category-ul li",function(e){displayItemsByCategory($$(this).attr("name"))}),$$(document).on("click",".shop-account-btn",function(e){mainView.router.load({pageName:"shop-account-balance-page"}),getAccountBalance()}),$$(document).on("click",".topup-account-bal-btn",function(e){myApp.prompt("You will be able to purchase anything using the deposited amount in this store!","LOAD ACCOUNT ("+currencyCode+")",function(e){""!=e&&scanCard("",0,0,"loadAccount",e)})}),$$(document).on("click",".add-pawnOrSell-btn",function(e){var t=deviceReady.returnSocket(),i=$$(".pawn-sell-item-name").val(),a=$$(".pawn-sell-item-description").val(),o=$$(".pawn-sell-expected-cash").val(),s=$$(".select-insert-category-input").val(),r=$$(".media-preview-image").attr("uploadSrc"),n=Date.now(),c=$$(this).attr("title"),l="files/items/"+phoneNo+n+".png";""!=i&&""!=a&&""!=o&&"SELECT CATEGORY"!=s?""!=r?(getGPS(function(e,d){uploadFile(r,l,"image/png",function(r){"success"==r&&t.emit("addPawnSell",i,a,o,l,e,d,n,c,phoneNo,s,function(e){stopProcess(),e?(pawnOrSellFn(c),myApp.alert("You can now wait for bids or visit a nearest store!","ITEM PLACED FOR "+c+"ING"),$$(".pawn-sell-item-name,.pawn-sell-item-description,.pawn-sell-expected-cash").val(""),$$(".media-preview-image").attr("uploadSrc","")):showToast("There was an error while trying to "+c.toLowerCase()+" your item!")})})}),processStatus(6e4)):showToast("Please select an image to proceed!"):showToast("All fields are mandatory!")}),$$(document).on("click",".pawnOrSell-option-btn",function(e){var t=$$(this).attr("itemName"),i=$$(this).attr("expectedCash"),a=$$(this).attr("itemDesc"),o=$$(this).attr("itemIcon"),s=$$(this).attr("id"),r=$$(this).attr("date"),n=$$(this).attr("status"),c=$$(this).attr("pawnOrSell"),l=$$(this).attr("result"),d=$$(this).attr("itemOwner");$$(".popover-pawnOrSell-ul li a").attr("itemName",t).attr("expectedCash",i).attr("itemDesc",a).attr("itemIcon",o).attr("id",s).attr("date",r).attr("status",n).attr("pawnOrSell",c).attr("itemOwner",l).attr("itemOwner",d)}),$$(document).on("click",".popover-pawnOrSell-ul li a",function(e){var t=$$(this).attr("itemName"),i=$$(this).attr("expectedCash"),a=$$(this).attr("itemDesc"),o=$$(this).attr("itemIcon"),s=$$(this).attr("id"),r=$$(this).attr("date"),n=$$(this).attr("status"),c=$$(this).attr("pawnOrSell"),l=$$(this).attr("title"),d=$$(this).attr("itemOwner");"pawnOrSell-details-btn"==l?viewPawnSellDetails(t,i,a,o,s,r,n,c):"pawnOrSell-nearby-btn"==l?getNearByAgents(t,i,a,o,s,r,n,c):"pawnOrSell-terminate-btn"==l?terminatePawnSell(t,i,a,o,s,r,n,c):"pawnOrSell-bids-btn"==l?viewBids(s,t,i,c):"pawnOrSell-place-bid-btn"==l?placeBid(t,i,a,o,s,r,n,c):"pawnOrSell-call-btn"==l&&(window.location="tel:"+d)}),$$(document).on("click",".place-bid-btn",function(e){var t=$$(this).attr("id"),i=$$(this).attr("pawnOrSell"),a=$$(".bid-offer-input").val(),o=$$(".bid-interest-input").val(),s=(parseFloat(o)/100*parseFloat(a)+parseFloat(a)).toFixed(2);"PAWN"==i?""!=a&&""!=o?myApp.confirm("Your interest is "+o+"%. The item owner will have to pay you "+s+" to reclaim the item!","YOU OFFER IS "+parseFloat(a).toFixed(2),function(e){placeBidNow(t,a,o,s)}):showToast("All fields are supposed to be filled!"):""!=a?myApp.confirm("Press proceed to place your bid!","YOU OFFER IS "+parseFloat(a).toFixed(2),function(e){placeBidNow(t,a,0,0)}):showToast("Please include your offer!")}),$$(document).on("click",".pawnOrSell-bid-option-btn",function(e){var t=$$(this).attr("shopName"),i=$$(this).attr("shopId"),a=$$(this).attr("offers"),o=$$(this).attr("interest"),s=$$(this).attr("id"),r=$$(this).attr("latitude"),n=$$(this).attr("longitude"),c=$$(this).attr("toPay"),l=$$(this).attr("staffPhone"),d=$$(this).attr("pawnOrSell");$$(".popover-bid-pawnOrSell-ul li a").attr("shopName",t).attr("staffPhone",l).attr("shopId",i).attr("offers",a).attr("interest",o).attr("id",s).attr("latitude",r).attr("longitude",n).attr("toPay",c).attr("pawnOrSell",d)}),$$(document).on("click",".popover-bid-pawnOrSell-ul li a",function(e){var t=$$(this).attr("shopName"),i=$$(this).attr("shopId"),a=$$(this).attr("offers"),o=$$(this).attr("interest"),s=$$(this).attr("id"),r=$$(this).attr("latitude"),n=$$(this).attr("longitude"),c=$$(this).attr("toPay"),l=$$(this).attr("staffPhone"),d=$$(this).attr("title"),p=$$(this).attr("pawnOrSell");"pawnOrSell-accept-bid-btn"==d?acceptBid(i,a,o,s,c,p):"pawnOrSell-visit-agent-btn"==d?getDirection(r,n,t):"pawnOrSell-call-agent-btn"==d&&(window.location="tel:"+l)}),$$(document).on("click",".call-agent-btn",function(e){var t=$$(this).attr("phone");window.location="tel:"+t}),$$(document).on("click",".browse-icon-btn",function(e){$$(".hiddenFileInputAvatar").click()}),$$(document).on("change",".hiddenFileInputAvatar",function(e){var t=new FileReader;t.onload=function(){var e=t.result;"image/jpg"!=base64Mime(e)&&"image/png"!=base64Mime(e)&&"image/jpeg"!=base64Mime(e)||($$(".my-avatar").attr("src",e),mainView.router.load({pageName:"media-preview-page"}),$(".media-preview-image").attr("src",e))},t.readAsDataURL($(this).prop("files")[0])}),$$(document).on("click",".pay-go-to-card-details-btn",function(e){"customer"==userLogged?mainView.router.load({pageName:"update-number-page"}):(mainView.router.load({pageName:"payment-method-page"}),deliveryLat=0,deliveryLng=0)}),$$(document).on("click",".finish-order-btn",function(e){"customer"==userLogged?selectPurchaseLocation("smartRestaurant"):finishPayments("local","smartRestaurant")}),$$(document).on("click",".payment-ul .shop-list-ul-card",function(e){var t=$$(this).attr("location"),i=deliveryLat,a=deliveryLng,o="website",s=$$(this).attr("title");if("remote"==t)var r=4*serviceFee;else r=2*serviceFee;r+=.15*deliveryFee;var n=(parseFloat(r)+parseFloat(totalCost)).toFixed(2);if("card-payment-btn"==s)1==accountActive?scanCard(t,i,a,o,"CC"):accountIsSuspended();else if("cash-payment-btn"==s)"customer"!=userLogged?myApp.prompt("Lets calculate the change. Enter amount received","TOTAL "+currencyCode+" "+n,function(e){var s=parseFloat(e)-n;s>-1?(myApp.alert(currencyCode+" "+s.toFixed(2),"CHANGE DUE"),processPayment("",n,"","",t,i,a,o,"CA"),processStatus(1e4)):showToast("The amount received is lower than items cost!")}):myApp.prompt("Please pay "+currencyCode+n+" to the cashier on the till!","ENTER TILL NUMBER",function(e){""!=e&&(requestForCashier("",n,"","",t,i,a,o,"CA",e),processStatus(6e4))});else if("pay-later-btn"==s)processPayment("",n,"","",t,i,a,o,"LT"),processStatus(1e4);else if("account-bal-btn"==s)accountBal>=totalCost?(processPayment("",n,"","",t,i,a,o,"AC"),processStatus(1e4)):showToast("You have insufficient balance to pay for your items!");else if("paypal-btn"==s)if(paypalObj.length>0)for(var c=0;c<paypalObj.length;c++){var l=paypalObj[c].secretKey,d=paypalObj[c].publicKey,p=paypalObj[c].otherKey;"PAYPAL"==paypalObj[c].name&&payPalProcess(l,d,p,n,t,i,a,o,"PP")}else showToast("This payment method is not available in this particular shop!");else if("pay-fast-btn"==s)if(paypalObj.length>0)for(c=0;c<paypalObj.length;c++){l=paypalObj[c].secretKey,d=paypalObj[c].publicKey,p=paypalObj[c].otherKey;"PAYFAST"==paypalObj[c].name&&payPalProcess(l,d,p,n,t,i,a,o,"PF")}else showToast("This payment method is not available in this particular shop!")});var cardIOResponseFields=["card_type","card_number","expiry_month","expiry_year","cvv"];function scanCard(e,t,i,a,o){mainView.router.load({pageName:"credit-card-page"}),$$(document).on("click",".pass-cc-info-btn",function(s){var r=$$(".credit-card-number").val(),n=$$(".expiry-month-input").val(),c=$$(".expiry-year-input").val(),l=$$(".cvv-input").val();16==r.length?3==l.length?""!=n?processCardPayment(r,n,c,l,e,t,i,a,o):showToast("Enter card expiry month"):showToast("cvv should be 3 characters long!"):showToast("Card number should be 16 characters long!")})}var printList=[],printAmount=0,receiptNo=0;function paymentSuccess(e,t){if(mainView.router.load({pageName:"payment-success-page"}),$$(".search-printer-devices-btn").hide(),"smartRestaurant"==e)if(0!=t){var i="Your order has been placed, Please wait while it is being prepared!",a="<i class='material-icons color-green' style='font-size:150px;'>check_circle</i>";itemListArray=[],totalCost=0,totalBuying=0,totalWeight=0,$$(".total-cost-div,.all-total-cost-div,.after-items-price,.after-delivery-fee,.after-service-fee").text(currencyCode+"0.00"),$$(".item-card-show").remove(),"shop"==userLogged&&$$(".search-printer-devices-btn").show()}else i="Could not place your order, Please make sure your payment method is valid!",a="<i class='material-icons color-tomato' style='font-size:150px;'>error_outline</i>";else if("smartStore"==e||"website"==e)if(0!=t){i="You have successfully paid for your items. Thank you",a="<i class='material-icons color-green' style='font-size:150px;'>check_circle</i>";itemListArray=[],totalCost=0,totalBuying=0,totalWeight=0,$$(".total-cost-div,.all-total-cost-div,.after-items-price,.after-delivery-fee,.after-service-fee").text(currencyCode+"0.00"),$$(".item-card-show").remove(),"shop"==userLogged&&$$(".search-printer-devices-btn").show()}else i="Could not complete the payment, Your payment method has been denied",a="<i class='material-icons color-tomato' style='font-size:150px;'>error_outline</i>";else if("subscription"==e)if(1==t){i="Your subscription was success. Happy business month!",a="<i class='material-icons color-green' style='font-size:150px;'>check_circle</i>";itemListArray=[],totalCost=0,totalBuying=0,totalWeight=0,$$(".total-cost-div,.all-total-cost-div,.after-items-price,.after-delivery-fee,.after-service-fee").text(currencyCode+"0.00"),$$(".item-card-show").remove()}else i="Error, Could not subscribe, please make sure your payment method is valid",a="<i class='material-icons color-tomato' style='font-size:150px;'>error_outline</i>";$$(".success-status-div").html("<div class='content-block'><center>"+a+"</center><div class='content-block'><center style='font-weight:bolder;color:#757575;'>"+i.toUpperCase()+"</center></div></div>"),$$(".show-total-amount").html("0.00"),$$(".display-items-cart-ul").html("")}function uploadFile(e,t,i,a){var o=new FileUploadOptions;o.fileKey="fileUrl",o.fileName=e.substr(e.lastIndexOf("/")+1),o.mimeType=i;var s=new Object;s.filePath=t,o.params=s,o.chunkedMode=!1,(new FileTransfer).upload(e,"https://www.smartstore.techapis.xyz/upload",function(e){a("success")},function(e){a("error")},o)}function processCardPayment(e,t,i,a,o,s,r,n,c){var l={number:e,expMonth:t,expYear:i,cvc:a};if("remote"==o)var d=4*serviceFee;else d=2*serviceFee;d+=.15*deliveryFee;var p=(parseFloat(d)+parseFloat(totalCost)).toFixed(2);paymentGatewayObj.length>0?("STRIPE"==paymentGatewayObj[0].name?stripeAuth(l,p,o,s,r,n,c):"2CHECKOUT"==paymentGatewayObj[0].name&&tCheckoutAuth(e,t,i,a,p,o,s,r,n,c),processStatus(3e4)):showToast("Sorry this method is currently not available. Try paypal or cash")}function stripeAuth(e,t,i,a,o,s,r){Stripe.setPublishableKey(paymentGatewayObj[0].publicKey),Stripe.card.createToken(e,function(e,n){if(n.error)showToast("Error could not tokenize the card");else{var c=n.id,l=paymentGatewayObj[0].secretKey;processPayment("STRIPE",t,c,l,i,a,o,s,r)}})}function tCheckoutAuth(e,t,i,a,o,s,r,n,c,l){var d={sellerId:paymentGatewayObj[0].otherKey,publishableKey:paymentGatewayObj[0].publicKey,ccNo:e,cvv:a,expMonth:t,expYear:i};TCO.loadPubKey("production",function(){TCO.requestToken(function(e){var t=e.response.token.token,i=paymentGatewayObj[0].secretKey;processPayment("2CHECKOUT",o,t,i,s,r,n,c,l)},function(e){200===e.errorCode?tCheckoutAuth(card_number,exp_date,a,cb):showToast("The seller is "+e.errorMsg+" to use this payment gateway")},d)})}function payPalProcess(e,t,i,a,o,s,r,n,c){var l=JSON.stringify(itemListArray),d=deviceReady.returnSocket(),p=formatted_date(new Date);if("remote"==o)var m=4*serviceFee;else m=2*serviceFee;if(m+=.15*deliveryFee,"PP"==c){var u=serverUrl+"paypalProcess/"+currentShopId+"/secretKey/"+e+"/publicKey/"+t+"/amount/"+a+"/location/"+o+"/latitude/"+s+"/longitude/"+r+"/option/"+n+"/itemListString/"+l+"/loggedInUser/"+loggedInUser+"/totalBuying/"+totalBuying+"/purchaseDay/"+p+"/totalWeight/"+totalWeight+"/currencyCode/"+currencyCode+"/serviceFee/"+m+"/currentShopName/"+currentShopName+"/deliveryFee/"+deliveryFee+"/distanceFromStore/"+distanceFromStore;window.location=u}else if("PF"==c){t="publicKey",e="secretKey";var v=serverUrl+"payFastFailedWeb/"+loggedInUser;u="https://www.payfast.co.za/eng/process?cmd=_paynow&receiver="+i+"&item_name="+currentShopName+" purchase&item_description=You are purchasing items from "+currentShopName+" worth "+a+"&amount="+a+"&return_url="+encodeURIComponent(serverUrl+"payFastSuccessWeb/"+loggedInUser)+"&cancel_url="+encodeURIComponent(v);d.emit("payFastWait",currentShopId,a,o,s,r,n,l,loggedInUser,totalBuying,p,totalWeight,currencyCode,m,currentShopName,deliveryFee,distanceFromStore,function(e){e&&(window.location=u)})}}function processPayment(e,t,i,a,o,s,r,n,c){var l=deviceReady.returnSocket(),d=paymentGatewayObj[0].otherKey,p=JSON.stringify(itemListArray);if("remote"==o)var m=4*serviceFee;else m=2*serviceFee;m+=.15*deliveryFee,"loadAccount"!=n?l.emit("processPayment",e,t,i,a,currentShopId,p,loggedInUser,totalBuying,formatted_date(new Date),totalWeight,currencyCode,d,o,s,r,n,c,m,currentShopName,deliveryFee,distanceFromStore,function(e){stopProcess(),paymentSuccess(n,e),0!=e&&"AC"==c&&(accountBal-=parseFloat(t))}):l.emit("loadAccount",e,c,i,a,d,currentShopId,currencyCode,loggedInUser,function(e){mainView.router.load({pageName:"payment-success-page"}),stopProcess(),1==e?$$(".success-status-div").html("<div class='content-block'><center><i class='material-icons color-green' style='font-size:150px;'>check_circle</i></center><div class='content-block'><center style='font-weight:bolder;color:#757575;'>YOU HAVE SUCCESSFULLY LOADED YOUR ACCOUNT</center></div></div>"):$$(".success-status-div").html("<div class='content-block'><center><i class='material-icons color-tomato' style='font-size:150px;'>error_outline</i></center><div class='content-block'><center style='font-weight:bolder;color:#757575;'>THERE WAS AN ERROR OR YOUR CARD WAS DECLINED</center></div></div>")})}function getGateways(){var e=deviceReady.returnSocket();$$(".all-gateways-ul").html(""),e.emit("get-my-gateways",currentShopId,function(e){if(stopProcess(),e.length>0)for(var t=0;t<e.length;t++){var i=e[t].id,a=e[t].name,o=e[t].publicKey,s=e[t].secretKey,r=e[t].otherKey,n=e[t].defaultStatus;if("default"==n)var c="<i class='material-icons color-green'>check_circle</i>";else c="<i class='material-icons color-gray'>more_vert</i>";$$(".all-gateways-ul").append("<li gatewayId='"+i+"' id='"+i+"' name='"+a+"' publicKey='"+o+"' secretKey='"+s+"' otherKey='"+r+"' defaultStatus='"+n+"' data-popover='.popover-gateway-option' class='open-popover popover-gateway-option-btn'><div class='item-content item-link'><div class='item-media'><i class='material-icons color-cyan'>credit_card</i></div><div class='item-inner'><div class='item-title' style='margin-top:10px;'>"+a+"</div><div class='item-after'>"+c+"</div></div></div></li>")}else showToast("You currently don't have any payment method. Click the add button to add")}),processStatus(1e4)}function makeGateWayDefault(e,t,i,a,o,s){var r=deviceReady.returnSocket();"PAYPAL"!=t&&"PAYFAST"!=t?myApp.confirm(t+" will be your default payment gateway!. Make sure it is activated","CONFIRM ACTION",function(t){r.emit("makeGateWayDefault",e,currentShopId,function(e){stopProcess(),e&&(getGateways(),getServiceAvailable())}),processStatus(1e4)}):showToast("This is your alternative payment gateway")}function removeGateway(e,t,i,a,o,s){var r=deviceReady.returnSocket();myApp.confirm(t+" will be deleted from your payment gateway lists","CONFIRM ACTION",function(t){r.emit("removeGateway",e,currentShopId,function(e){stopProcess(),e&&getGateways()}),processStatus(1e4)})}function editGateway(e,t,i,a,o,s){mainView.router.load({pageName:"add-gateway-page"}),$$(".add-update-gateway-btn").attr("title","update").attr("id",e),$$(".add-update-gateway-div").text("EDIT PAYMENT GATEWAY"),$$(".list-block-gateway-selector").hide(),$$(".publicKey-input").val(i),$$(".secretKey-input").val(a),$$(".otherKey-input").val(o)}$$(document).on("click",".get-my-payment-gateways-btn",function(e){getGateways(),mainView.router.load({pageName:"payment-gateway-page"})}),$$(document).on("click",".popover-gateway-option-btn",function(e){var t=$$(this).attr("id"),i=$$(this).attr("name"),a=$$(this).attr("publicKey"),o=$$(this).attr("secretKey"),s=$$(this).attr("otherKey"),r=$$(this).attr("defaultStatus");$$(".gateway-ul-li-btn li a").attr("id",t).attr("name",i).attr("publicKey",a).attr("secretKey",o).attr("otherKey",s).attr("defaultStatus",r)}),$$(document).on("click",".gateway-ul-li-btn li a",function(e){var t=$$(this).attr("id"),i=$$(this).attr("name"),a=$$(this).attr("publicKey"),o=$$(this).attr("secretKey"),s=$$(this).attr("otherKey"),r=$$(this).attr("defaultStatus"),n=$$(this).attr("title");"MAKE DEFAULT"==n?makeGateWayDefault(t,i,a,o,s,r):"REMOVE"==n?removeGateway(t,i,a,o,s,r):"EDIT"==n&&editGateway(t,i,a,o,s,r)}),$$(document).on("click",".add-gateway-navigator",function(e){$$(".add-update-gateway-btn").attr("id","").attr("title","add"),$$(".add-update-gateway-div").text("ADD PAYMENT GATEWAY"),$$(".list-block-gateway-selector").show()}),$$(document).on("change",".select-gateway-input",function(e){"PAYFAST"==$$(this).val()?$$(".publicKey-input-li,.secretKey-input-li").hide():$$(".publicKey-input-li,.secretKey-input-li").show()}),$$(document).on("click",".add-update-gateway-btn",function(e){var t=deviceReady.returnSocket(),i=$$(".select-gateway-input").val(),a=$$(".publicKey-input").val(),o=$$(".secretKey-input").val(),s=$$(".otherKey-input").val(),r=$$(this).attr("title"),n=$$(this).attr("id");""!=a&&""!=o&&"PAYFAST"!=i||"PAYFAST"==i&&""!=s?"add"==r?myApp.confirm("Have you carefully entered your gateway credentials? Click proceed button if yes","ADD GATEWAY",function(e){t.emit("addGateway",i,a,o,s,currentShopId,function(e){stopProcess(),1==e?(showToast("You have successfully added a new payment gateway"),$$(".publicKey-input,.secretKey-input,.otherKey-input").val(""),getGateways()):showToast("Payment gateway could not be added!")}),processStatus(1e4)}):myApp.confirm("Have you carefully entered your gateway credentials? Click proceed button if yes","EDIT GATEWAY",function(e){t.emit("editGateway",n,i,a,o,s,currentShopId,function(e){stopProcess(),1==e?(showToast("You have successfully updated your payment gateway"),getGateways()):showToast("Payment gateway could not be updated!")}),processStatus(1e4)}):showToast("You are missing some important values!")}),$$(document).on("click",".tnc-btn",function(e){window.location="https://www.smartstoreweb.net/terms.html"});var workingHours=[{day:"Sun",openTime:"8:00",closeTime:"20:00",id:1},{day:"Mon",openTime:"8:00",closeTime:"20:00",id:2},{day:"Tue",openTime:"8:00",closeTime:"20:00",id:3},{day:"Wed",openTime:"8:00",closeTime:"20:00",id:4},{day:"Thu",openTime:"8:00",closeTime:"20:00",id:5},{day:"Fri",openTime:"8:00",closeTime:"20:00",id:6},{day:"Sat",openTime:"8:00",closeTime:"20:00",id:7}];function updateWorkingHours(e,t,i){$$(".hours-status-header").text(e+" "+t+" HOURS"),$$(".working-hours-select-ul").html("");for(var a=0;a<25;a++){var o=a+":00";$$(".working-hours-select-ul").append("<li id='"+o+"' day='"+e+"' status='"+t+"' counter='"+i+"'><div class='item-content item-link'><div class='item-media'><i class='material-icons color-teal'>today</i></div><div class='item-inner'><div class='item-title' style='margin-top:10px;'>"+o+"</div></div></div></li>")}mainView.router.load({pageName:"working-hours-select-page"})}function isStoreOpen(e){var t=new Date,i=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][t.getDay()].slice(0,3),a=t.getHours();e=JSON.parse(e);for(var o=0;o<e.length;o++){var s=e[o].day,r=e[o].openTime,n=e[o].closeTime;e[o].id;s==i&&(a>=parseFloat(r.split(":")[0])&&a<parseFloat(n.split(":")[0])?(openStatus=!0,$$(".store-closed-btn").attr("title","This Store is open and scheduled to be closed at "+n)):(openStatus=!1,$$(".store-closed-btn").attr("title","This Store is closed. You can not make any purchase from it!. Please try after "+r)))}}$$(document).on("click",".show-working-hours-btn",function(e){mainView.router.load({pageName:"working-hours-page"}),deviceReady.returnSocket().emit("customerLogin",currentShopId,function(e){$$(".working-hours-ul").html(""),workingHours=(workingHours=""!=e[0].workingHours?JSON.parse(e[0].workingHours):workingHours).sort((e,t)=>Number(e.id)-Number(t.id));for(var t=0;t<workingHours.length;t++){var i=workingHours[t].day,a=workingHours[t].openTime,o=workingHours[t].closeTime,s=workingHours[t].id;$$(".working-hours-ul").append("<li class='working-option-btn' id='"+i+"' counter='"+s+"'><div class='item-content item-link'><div class='item-media'><i class='material-icons color-teal'>today</i></div><div class='item-inner'><div class='item-title' style='margin-top:10px;'>"+i+"</div><div class='item-after' id='time"+i+"'>"+a+"-"+o+"</div></div></div></li>")}})}),$$(document).on("click",".working-option-btn",function(e){var t=this.id,i=$$(this).attr("counter");myApp.actions([[{text:"UPDATE OPEN TIME",onClick:function(){updateWorkingHours(t,"OPEN",i)}},{text:"UPDATE CLOSE TIME",onClick:function(){updateWorkingHours(t,"CLOSE",i)}}]])}),$$(document).on("click",".working-hours-select-ul li",function(e){var t=deviceReady.returnSocket(),i=$$(this).attr("id"),a=$$(this).attr("day"),o=$$(this).attr("counter"),s=$$(this).attr("status"),r=$$("[id='time"+a+"']").text();"OPEN"==s?($$("[id='time"+a+"']").text(i+"-"+r.split("-")[1]),removeItemDay(workingHours,a),workingHours.push({day:a,openTime:i,closeTime:r.split("-")[1],id:o})):($$("[id='time"+a+"']").text(r.split("-")[0]+"-"+i),removeItemDay(workingHours,a),workingHours.push({day:a,openTime:r.split("-")[0],closeTime:i,id:o})),window.history.back(),t.emit("updateWorkingHours",currentShopId,JSON.stringify(workingHours),function(e){showToast(1==e?"Your working hours were updated!":"Could not update working hours!")})}),$$(document).on("click",".special-deals-btn",function(e){var t=deviceReady.returnSocket();mainView.router.load({pageName:"pawnOrSell-nearby-page"}),$$(".local-store-agents").text("LOCAL SPECIAL DEALS"),$$(".pawn-sell-nearby-ul").html(""),$$(".hide-on-agents").hide(),getGPS(function(e,i){t.emit("getLocalStores",e,i,function(e){if(e.length>0){var i=e.length;e.forEach(function(a,o){var s=e[o].shopName,r=e[o].shopId,n=e[o].latitude,c=e[o].longitude;e[o].staffPhone;t.emit("getShopsWithSpecial",r,function(e){stopProcess(),e.length>0?$$(".pawn-sell-nearby-ul").prepend("<li><div class='item-content'><div class='item-inner'><div class='item-title'>"+s+"</div><div class='item-after'><a href='#' class='button view-specials-btn' shopId='"+r+"' specials='"+JSON.stringify(e)+"'><span style='margin-top:-5px;color:#757575;'>"+e.length+"</span><i class='material-icons color-orange'>grade</i></a><a href='#' class='button getLocationBtn' latitude='"+n+"' longitude='"+c+"' shopName='"+s+"'><i class='material-icons color-teal'>location_on</i></a></div></div></div></li>"):i--,0==i&&showToast("Oops! There are no specials at the moment!")})})}else showToast("Sorry!, We could not find local stores for you!")})}),processStatus(1e4)}),$$(document).on("click",".view-specials-btn",function(e){selfLogin(currentShopId=$$(this).attr("shopId"),"specials")}),$$(document).on("change",".advanced-checkbox",function(e){var t=$$(this).attr("title"),i=deviceReady.returnSocket();if($(this).attr("checked")){$(this).removeAttr("checked");var a=!1,o="FALSE"}else{$(this).attr("checked","checked");a=!0,o="TRUE"}if(a){if("online-store-checkbox"==t)var s="By enabling online store feature, You agree that local customers can make online purchases from your store?";else if("pawn-buy-checkbox"==t)s="By enabling pawning feature you agree that you are allowed by the law to operate in that area. Smart Store is not responsible for any inconvenience.";else if("own-drivers-checkbox"==t)s="By enabling smartStore driver you agree that smartStore drivers will be responsible for delivering items to your customers?"}else if("online-store-checkbox"==t)s="By disabling online store feature, You agree that local customers can not make online purchases from your store?";else if("pawn-buy-checkbox"==t)s="By disabling pawning feature you agree that your store will no longer provide this feature";else if("own-drivers-checkbox"==t)s="By disabling smartStore driver you agree that you have your own drivers to take care of the delivery";if("online-store-checkbox"==t)var r="remoteOrdering";else if("pawn-buy-checkbox"==t)r="pawnBuy";else if("own-drivers-checkbox"==t)r="smartDriver";myApp.confirm(s,"CONFIRM UPDATE",function(e){i.emit("updateAdvanced",r,o,currentShopId,function(e){stopProcess(),e&&showToast("Your updates were successful!")}),processStatus(1e4)})});